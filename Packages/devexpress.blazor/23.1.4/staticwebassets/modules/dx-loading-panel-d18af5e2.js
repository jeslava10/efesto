import{_ as t}from"./_tslib-6e8ca86b.js";import{S as e}from"./single-slot-element-base-d44a6577.js";import{L as s}from"./layouthelper-dc0e1370.js";import{defineDxCustomElement as n}from"./define-custom-element-ee3a9585.js";import{e as i}from"./property-d3853089.js";import{t as a}from"./state-949f2642.js";import{y as l}from"./lit-element-70cf14f4.js";import"./data-qa-utils-8be7c726.js";import"./dx-ui-element-7f5e2dd2.js";import"./logicaltreehelper-bc8e12d3.js";import"./lit-element-base-7a85dca5.js";import"./rect-00eb3fa4.js";import"./point-e4ec110e.js";import"./constants-58283e53.js";class r extends e{constructor(){super(...arguments),this.attachPanelHandler=this.attachPanel.bind(this),this.resizePanelHandler=this.resizePanel.bind(this),this.panel=null,this.targetElement=null,this.targetResizeObserver=null,this.panelItems=[],this.positionTarget=null,this.panelVisible=!1,this.blockedContent=!1,this.hasContent=!1,this.zIndex=null,this.width="unset",this.height="unset",this.translateState="translate(0px; 0px)",this.trackingInterval=null,this.targetCurrentRect=null}render(){return l`
            <style>
                :host {
                    display: ${this.hasContent||this.panelVisible?"inline-block":"none"};
                    position: ${this.hasContent?"relative":"fixed"};
                    pointer-events: ${this.blockedContent||this.hasContent?"unset":"none"};
                    width: ${this.hasContent?"var(--dxbl-loading-panel-width)":this.width};
                    height: ${this.hasContent?"var(--dxbl-loading-panel-height)":this.height};
                    transform: ${this.hasContent?"none":this.translateState};
                    z-index: ${this.panelVisible&&this.zIndex&&!this.hasContent?this.zIndex:"auto"};
                }
            </style>
            <slot></slot>
        `}connectedCallback(){super.connectedCallback(),this.hasContent||window.addEventListener("resize",this.resizePanelHandler),this.panel=document.querySelector(`#${this.id}`)}disconnectedCallback(){var t;super.disconnectedCallback(),this.targetElement&&(null===(t=this.targetResizeObserver)||void 0===t||t.unobserve(this.targetElement),this.unsubscribeTargetScroll()),window.removeEventListener("resize",this.resizePanelHandler),this.disablePersistentAttaching()}updated(t){super.updated(t),t.has("positionTarget")&&(this.setTargetElement(),this.processPanelElements(),this.attachPanel(),this.resizePanel()),t.has("panelVisible")&&(!this.targetElement&&this.panelVisible&&this.setTargetElement(),this.attachPanel(),this.resizePanel(),this.checkBlockPanelTabIndexes()),t.has("blockedContent")&&this.checkBlockPanelTabIndexes()}setTargetElement(){var t;if(this.positionTarget){if(this.targetElement=document.querySelector(this.positionTarget),!this.targetElement)return;this.targetCurrentRect=this.targetElement.getBoundingClientRect(),this.subscribeTargetResize(),this.subscribeTargetScroll(),this.enablePersistentAttaching()}else this.targetElement&&(null===(t=this.targetResizeObserver)||void 0===t||t.unobserve(this.targetElement),this.targetElement=null)}attachPanel(){!this.hasContent&&this.targetElement&&this.panel&&requestAnimationFrame((()=>{const t=this.targetElement.getBoundingClientRect();this.translateState=`translate(${t.left+this.scrollLeft}px, ${t.top+this.scrollTop}px)`}))}resizePanel(){this.targetElement&&this.panel&&requestAnimationFrame((()=>{const t=this.targetElement.getBoundingClientRect();this.width=t.width+"px",this.height=t.height+"px"}))}processPanelElements(){this.targetElement&&(this.checkAndAddElementTabIndex(this.targetElement),this.processPanelChildElements(this.targetElement))}checkAndAddElementTabIndex(t){this.panelItems.map((t=>t.element)).indexOf(t)<0&&this.panelItems.push({element:t,tabIndex:t.hasAttribute("tabIndex")?t.tabIndex:null})}processPanelChildElements(t){const e=t.childNodes;for(let t=0;t<e.length;t++){const s=e[t];s instanceof HTMLElement&&(this.checkAndAddElementTabIndex(s),this.processPanelChildElements(s))}}checkBlockPanelTabIndexes(){this.panelItems.length&&this.panelItems.forEach((t=>{this.blockedContent&&this.panelVisible?t.element.tabIndex=-1:null!==t.tabIndex?t.element.tabIndex=t.tabIndex:t.element.removeAttribute("tabIndex")}))}subscribeTargetResize(){this.targetResizeObserver=new ResizeObserver((()=>this.resizePanel())),this.targetResizeObserver.observe(this.targetElement)}enablePersistentAttaching(){this.trackingInterval=setInterval((()=>{const t=this.targetElement.getBoundingClientRect();t.top===this.targetCurrentRect.top&&t.left===this.targetCurrentRect.left||(this.targetCurrentRect=t,this.attachPanel())}),0)}disablePersistentAttaching(){this.trackingInterval&&clearInterval(this.trackingInterval)}subscribeTargetScroll(){this.getTargetRootElements().forEach((t=>t.addEventListener("scroll",this.attachPanelHandler)))}unsubscribeTargetScroll(){this.getTargetRootElements().forEach((t=>t.removeEventListener("scroll",this.attachPanelHandler)))}getTargetRootElements(){return[...s.getRootPath(this.targetElement)].filter((t=>t instanceof HTMLElement)).map((t=>t))}}t([i({type:String,attribute:"position-target",reflect:!0})],r.prototype,"positionTarget",void 0),t([i({type:Boolean,attribute:"panel-visible"})],r.prototype,"panelVisible",void 0),t([i({type:Boolean,attribute:"blocked-content"})],r.prototype,"blockedContent",void 0),t([i({type:Boolean,attribute:"has-content"})],r.prototype,"hasContent",void 0),t([i({type:Number,attribute:"z-index"})],r.prototype,"zIndex",void 0),t([a()],r.prototype,"width",void 0),t([a()],r.prototype,"height",void 0),t([a()],r.prototype,"translateState",void 0),n(customElements,"dxbl-loading-panel",r);export{r as default};
