import{_ as e}from"./_tslib-6e8ca86b.js";import{a as t,R as i,S as s}from"./rect-00eb3fa4.js";import{R as n}from"./rafaction-bba7928b.js";import{P as o,a as r}from"./point-e4ec110e.js";import{T as a}from"./transformhelper-ebad0156.js";import{L as h,D as l}from"./layouthelper-dc0e1370.js";import{PositionChangingEvent as d}from"./positiontracker-1fe0834d.js";import{D as c}from"./constants-58283e53.js";import{BranchCreatedEvent as u,BranchUpdatedEvent as p,BranchRemovedEvent as m,BranchActivatedEvent as g,BranchRefreshedEvent as b,BranchIdContext as f}from"./branch-bf06b0d2.js";import{L as v,c as C}from"./capturemanager-86a8762a.js";import{E as y}from"./eventhelper-8570b930.js";import{L as w,i as P}from"./logicaltreehelper-bc8e12d3.js";import{D as T}from"./data-qa-utils-8be7c726.js";import{s as R,i as E,y as x}from"./lit-element-70cf14f4.js";import{e as I}from"./property-d3853089.js";import{e as H}from"./custom-element-267f9a21.js";import{P as N}from"./pointer-event-helper-ba4ce1e1.js";import{D as L}from"./dx-ui-element-7f5e2dd2.js";import{n as _}from"./nameof-factory-64d95f5b.js";import{C as B}from"./custom-events-helper-18f7786a.js";const O=new class{constructor(){this._x=0,this._y=0,this.handlePointerDown=this.pointerEventHandler.bind(this)}get x(){return this._x}get y(){return this._y}subscribe(){window.addEventListener("pointerdown",this.handlePointerDown,{capture:!0,passive:!0}),window.addEventListener("pointermove",this.handlePointerDown,{capture:!0,passive:!0}),window.addEventListener("pointerup",this.handlePointerDown,{capture:!0,passive:!0})}unsubscribe(){window.removeEventListener("pointerdown",this.handlePointerDown),window.removeEventListener("pointermove",this.handlePointerDown),window.removeEventListener("pointerup",this.handlePointerDown)}pointerEventHandler(e){this._x=e.pageX,this._y=e.pageY}};O.subscribe();class z{get x(){return this.xField}get y(){return this.yField}constructor(e,t){this.xField=e,this.yField=t}}z.zero=new z(0,0);class S{static add(e,t){return new z(e.x+t.x,e.y+t.y)}static multiply(e,t){return new z(e.x*t,e.y*(1/t))}static divide(e,t){return new z(e.x*(1/t),e.y*(1/t))}static getLength(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static normalize(e){const t=Math.max(Math.abs(e.x),Math.max(e.y)),i=S.divide(e,t);return S.divide(i,S.getLength(i))}}class D{static viewport(){return new t(window.scrollX,window.scrollY,document.documentElement.clientWidth,document.documentElement.clientHeight)}static page(){return new t(0,0,document.body.clientWidth,document.body.clientHeight)}}class A{get position(){return this.callback(this.target)}constructor(e,t){this.target=e,this.callback=t}}class k{get raf(){return this.options.raf}constructor(e,t){this.observer=null,this.elementScrollHandler=this.handleElementScroll.bind(this),this.resizeHandler=this.handleResize.bind(this),this.overflows=[],this.resizing=[],this.targetElement=null,this.rafAction=new n,this.callback=e,this.options=t}observe(e){this.disconnect(),this.targetElement=e,this.subscribeEvents()}disconnect(){var e;this.unsubscribeEvents(),this.rafAction.cancel(),null===(e=this.observer)||void 0===e||e.disconnect(),this.observer=null}getTargetBoundingClientRect(){return this.targetElement?h.getRelativeElementRect(this.targetElement):t.Empty}subscribeEvents(){if(!this.targetElement)return;window.addEventListener("scroll",this.elementScrollHandler);const e=[],t=[];for(const i of h.getRootPathAndSelf(this.targetElement)){const s=i;if(!s)return;if(this.isInShadowDom(s))continue;new ResizeObserver(this.resizeHandler).observe(s,{box:"border-box"}),t.push(),l.isScrollable(s)&&(s.addEventListener("scroll",this.elementScrollHandler,{capture:!0}),e.push(s))}this.overflows=e,this.resizing=t}isInShadowDom(e){return e.getRootNode()instanceof ShadowRoot}unsubscribeEvents(){window.removeEventListener("scroll",this.elementScrollHandler),this.overflows.forEach((e=>{e.removeEventListener("scroll",this.elementScrollHandler)})),this.resizing.forEach((e=>{e.disconnect()}))}handleResize(e,t){this.raisePositionChanged()}handleElementScroll(e){this.raisePositionChanged()}raisePositionChanged(){this.raf?this.rafAction.execute((()=>this.raisePositionChangedCore())):this.raisePositionChangedCore()}raisePositionChangedCore(){this.callback(new A(this.targetElement,this.getTargetBoundingClientRect),this)}}class M{get hasObservedElement(){return null!==this.observedElement}constructor(e,t){this.target=null,this.targetMutationObserver=new MutationObserver((e=>this.handleTargetMutations.bind(this))),this.observedElement=null,this.selector=e,this.callback=t}observe(e=null){this.disconnect(),this.target=e;const t=null!=e?e:document;this.observedElement=t.querySelector(this.selector),this.observedElement&&this.raiseElementChanged(null,this.observedElement),this.targetMutationObserver.observe(t,{subtree:!0,childList:!0})}disconnect(){this.targetMutationObserver.disconnect()}raiseElementChanged(e,t){this.callback({oldElement:e,element:t},this)}handleTargetMutations(e,t){this.hasObservedElement?this.processRemovedNodes(e):this.processAddedNodes(e)}processRemovedNodes(e){this.processRemovedNodesInternal(e)&&(this.raiseElementChanged(this.observedElement,null),this.observedElement=null)}processRemovedNodesInternal(e){return e.forEach((e=>{e.removedNodes.forEach((e=>{if(this.observedElement===e)return!0}))})),!1}processAddedNodes(e){const[t,i]=this.processAddedNodesInternal(e);t&&(this.raiseElementChanged(this.observedElement,i),this.observedElement=i)}processAddedNodesInternal(e){var t;const i=(null!==(t=this.target)&&void 0!==t?t:document).querySelector(this.selector);return[null!==i,i]}}class F{constructor(){this._isResolved=!1,this._isRejected=!1,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}get promise(){return this._promise}resolve(e){this._isResolved=!0,this._resolve(e)}reject(e){this._isRejected=!0,this._reject(e)}tryResolve(e){this._isResolved||this._isRejected||this.resolve(e)}tryReject(e){this._isResolved||this._isRejected||this.reject(e)}}var j;!function(e){e.Modal="modal",e.DropDown="dropdown",e.Flyout="flyout",e.Window="window",e.Root="root"}(j||(j={}));class q{get type(){return this._type}get children(){return Array.from(this._children)}get hasChildren(){return this._children.size>0}get id(){return this._id}constructor(e,t,i){this._children=new Set,this._id=e,this._parentId=t,this._type=i}add(e){this._children.add(e)}remove(e){this._children.delete(e)}}class W{constructor(){this.idToNode=new Map,this.idToParentId=new Map,this.idToNode.set(W.root,new q(W.root,W.root,j.Root))}add(e,t,i){const s=new q(e,t=null!=t?t:W.root,i);this.idToParentId.set(e,t),this.idToNode.set(e,s);this.idToNode.get(t).add(s)}remove(e){if(!this.idToNode.has(e))return;const t=this.idToParentId.get(e),i=this.idToNode.get(t),s=this.idToNode.get(e);this.idToParentId.delete(e),this.idToNode.delete(e),i.remove(s)}getParentId(e){return this.idToParentId.get(e)}getBranchNode(e){var t;return null!==(t=this.idToNode.get(e))&&void 0!==t?t:null}findRoot(e){let t=e;for(;;){const e=this.idToParentId.get(t);if(e===W.root)return t;t=e}}}W.baseIndex=1050,W.root="";class V{get type(){return this.branchNode.type}get index(){return this._index}set index(e){this._index=e}get children(){return this._children}get hasChildren(){return this._children.length>0}get id(){return this.branchNode.id}constructor(e){this._children=new Array,this._index=0,this.branchNode=e}add(e){this._children.push(e)}remove(e){this._children=this._children.filter((t=>t!==e))}peek(){return this._children[this._children.length-1]}activate(e){return this.peek()!==e&&(this.remove(e),this.add(e),!0)}}const Z=new W,$=new class{constructor(){this.idToNode=new Map,this.rootNode=new V(Z.getBranchNode("")),this.idToNode.set("",this.rootNode)}getIndex(e){const t=this.idToNode.get(e);return t?t.index:0}register(e){const t=Z.findRoot(e),i=Z.getBranchNode(e),s=new V(i);if(this.idToNode.set(e,s),e===t)this.rootNode.add(s);else{const t=Z.getParentId(e);this.idToNode.get(t).add(s)}this.refresh()}unregister(e){var t;const i=null!==(t=this.idToNode.get(e))&&void 0!==t?t:null;if(!i)return;const s=Z.getParentId(i.id);this.idToNode.get(s).remove(i);for(const t of this.iterateBranch(e))this.idToNode.delete(t);this.idToNode.delete(e),this.refresh()}activate(e){var t,i,s;let n=null!==(t=this.idToNode.get(e))&&void 0!==t?t:null;if(!n)return!1;let o=!1;for(;n;){const e=Z.getParentId(n.id),t=null!==(i=this.idToNode.get(e))&&void 0!==i?i:null;o=o||null!==(s=null==t?void 0:t.activate(n))&&void 0!==s&&s,n=t}return o}iterateBranch(e){let t=new Array;const i=this.idToNode.get(e);if(!(null==i?void 0:i.hasChildren))return t;for(const e of i.children)t.push(e.id),t=t.concat(this.iterateBranch(e.id));return t.sort(((e,t)=>this.idToNode.get(t).index-this.idToNode.get(e).index))}refresh(){let e=!1,t=W.baseIndex;for(const i in this.rootNode.children){const s=this.rootNode.children[i];e?t+=this.incrementByType(s.type):e=!0,t=this.calculateZIndices(s,t)}}calculateZIndices(e,t){if(e.index=t,e.hasChildren)for(const i of e.children)t+=this.incrementByType(i.type),t=this.calculateZIndices(i,t);return t}incrementByType(e){switch(e){case j.Flyout:case j.DropDown:return 10;case j.Modal:return 100}return 10}setTopMostBranch(e){let t=this.idToNode.get(e)||null;for(;t&&t.type!==j.Modal;){const e=Z.getParentId(t.id);if(e){const i=this.idToNode.get(e);i.activate(t),t=i}else this.rootNode.activate(t),t=null}this.refresh()}};var U;!function(e){e.OutsideClick="OutsideClick",e.EscapePress="EscapePress",e.Programmatically="Programmatically"}(U||(U={}));const K="dxbl-portal";class X{constructor(e){this.elements=e}}class Y extends CustomEvent{constructor(e){super(Y.eventName,{detail:e,bubbles:!0})}}Y.eventName="dxbl-portable-elements-changed";let G=class extends R{constructor(){super(...arguments),this._portable=null,this._elementsPorted=!1,this.slotChangedHandler=this.handleSlotChange.bind(this)}get portable(){return this._portable}createRenderRoot(){const e=super.createRenderRoot(),t=document.createElement("slot");return e.appendChild(t),t.addEventListener("slotchange",this.slotChangedHandler),e}handleSlotChange(e){const t=e.target.assignedNodes();this._elementsPorted&&0===t.length||(this.assignElements(t),this._elementsPorted=!0)}assignElements(e){this._portable=e,this.raiseElementsChanged(e)}connectedCallback(){super.connectedCallback(),T.setLoaded(this),re().assign(this)}disconnectedCallback(){super.disconnectedCallback(),re().release(this),T.removeLoaded(this)}raiseElementsChanged(e){const t=new Y(new X(e));this.dispatchEvent(t)}updated(e){if(!this.branchId)throw new Error("branch-id must be specified")}};function J(){}e([I({type:String,attribute:"branch-id"})],G.prototype,"branchId",void 0),G=e([H(K)],G);const Q=Object.freeze({__proto__:null,dxPortalTagName:K,PortableElementsChangedEvent:Y,get DxPortal(){return G},init:J,default:{init:J,DxPortal:G,dxPortalTagName:K}}),ee="dxbl-popup-cell";let te=class extends R{constructor(){super(...arguments),this._portal=null,this.elements=null,this.elementsChangedHandler=this.handleElementsChanged.bind(this),this.zIndexDeltaChangeHandler=this.handleZIndexDeltaChange.bind(this),this.baseZIndex=0,this.zIndexDelta=0}get zIndex(){return this.baseZIndex+this.zIndexDelta}createRenderRoot(){return this}get portal(){return this._portal}setPortal(e){this.unsubscribe(),this._portal=e,this.subscribe(),this.updateElements(this.elements,e.portable)}connectedCallback(){super.connectedCallback(),this.subscribe()}subscribe(){this.addEventListener(Oe.eventName,this.zIndexDeltaChangeHandler),this.portal&&this.portal.addEventListener(Y.eventName,this.elementsChangedHandler)}unsubscribe(){this.removeEventListener(Oe.eventName,this.zIndexDeltaChangeHandler),this.portal&&this.portal.removeEventListener(Y.eventName,this.elementsChangedHandler)}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribe()}handleElementsChanged(e){this.updateElements(this.elements,e.detail.elements)}updateElements(e,t){e&&e.forEach((e=>this.removeChild(e))),this.elements=t,t&&this.append(...t)}handleZIndexDeltaChange(e){this.zIndexDelta=e.detail.zIndex}updated(e){(e.has("zIndex")||e.has("zIndexDelta")||e.has("baseZIndex"))&&(this.style.zIndex=String(this.zIndex))}};e([I({type:Number})],te.prototype,"baseZIndex",void 0),e([I({type:Number})],te.prototype,"zIndexDelta",void 0),e([I({type:Number,reflect:!0})],te.prototype,"zIndex",null),te=e([H(ee)],te);const ie="dxbl-popup-root",se=document.createElement("template");se.innerHTML="<"+ee+' class="'+ee+'" />';let ne=class extends R{constructor(){super(...arguments),this.activateLocker=new v,this.portalsMapping=new Map,this.portals=new Map,this.rafAction=new n,this.focusInHandler=this.handleFocusIn.bind(this),this.adjustZIndexRequestHandler=this.adjustZIndexRequest.bind(this),this.branchCreatedHandler=this.handleBranchCreated.bind(this),this.branchUpdatedHandler=this.handleBranchUpdated.bind(this),this.branchRemovedHandler=this.handleBranchRemoved.bind(this),this.branchActivatedHandler=this.handleBranchActivated.bind(this),this.branchRefreshedHandler=this.handleBranchRefreshed.bind(this)}createRenderRoot(){return this}assign(e){if(this.portals.has(e))return;const t=this.selectTemplate(e);this.appendChild(t);const i=this.children[this.children.length-1];i.setPortal(e),this.portalsMapping.set(e.branchId,e),this.portals.set(e,i)}release(e){const t=this.portals.get(e);this.portalsMapping.delete(e.branchId),this.portals.delete(e),this.removeChild(t)}connectedCallback(){super.connectedCallback(),this.tabIndex=0,this.addEventListener("focusin",this.focusInHandler,{capture:!0}),this.addEventListener(Se.eventName,this.adjustZIndexRequestHandler),this.addEventListener(u.eventName,this.branchCreatedHandler),this.addEventListener(p.eventName,this.branchUpdatedHandler),this.addEventListener(m.eventName,this.branchRemovedHandler),this.addEventListener(g.eventName,this.branchActivatedHandler),this.addEventListener(b.eventName,this.branchRefreshedHandler)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("focusin",this.focusInHandler),this.removeEventListener(Se.eventName,this.adjustZIndexRequestHandler),this.removeEventListener(u.eventName,this.branchCreatedHandler),this.removeEventListener(p.eventName,this.branchUpdatedHandler),this.removeEventListener(m.eventName,this.branchRemovedHandler),this.removeEventListener(g.eventName,this.branchActivatedHandler),this.removeEventListener(b.eventName,this.branchRefreshedHandler)}handleFocusIn(e){this.rafAction.cancel();e.target===this&&(y.markHandled(e),this.rafAction.execute((()=>this.blur())))}handleBranchCreated(e){Z.add(e.detail.id,e.detail.parentId,e.detail.type),this.assignZIndices()}handleBranchUpdated(e){Z.remove(e.detail.id),Z.add(e.detail.id,e.detail.parentId,e.detail.type),this.assignZIndices()}handleBranchRemoved(e){Z.remove(e.detail.id),this.assignZIndices()}handleBranchActivated(e){const t=e.detail.id;if(!$.activate(t)){const e=this.portalsMapping.get(t);return C.capture(e.popupBase),void this.assignZIndices()}const i=[];for(const e of $.iterateBranch(t)){const s=this.portalsMapping.get(e);if(i.push(s.popup),e===t)break}if(i.length>0)i.forEach((e=>C.releaseCapture(e))),i.forEach((e=>C.capture(e)));else{const e=this.portalsMapping.get(t);C.capture(e.popupBase)}this.assignZIndices()}handleBranchRefreshed(e){this.assignZIndices()}assignZIndices(){$.refresh();for(const e of this.portals.keys()){const t=e.branchId;this.portals.get(e).baseZIndex=$.getIndex(t)}}adjustZIndexRequest(e){const t=e.detail.branchId;this.isBranchExistsInDom(t)&&($.setTopMostBranch(t),this.assignZIndices())}isBranchExistsInDom(e){const t=this.portalsMapping.get(e);return!!t&&!!this.portals.get(t)}getPopup(e){const t=this.portalsMapping.get(e);return(null==t?void 0:t.popupBase)||null}selectTemplate(e){return se.content.cloneNode(!0)}};ne=e([H(ie)],ne);const oe=new class{constructor(){this._rootElementPromise=new Promise(((e,t)=>{const i=ie;customElements.whenDefined(i).then((()=>{const t=document.createElement(i);document.body.appendChild(t),e(t)}))}))}assign(e){this._rootElementPromise.then((t=>t.assign(e)))}getPopup(e){return this._rootElementPromise.then((t=>t.getPopup(e)))}release(e){this._rootElementPromise.then((t=>t.release(e)))}};function re(){return oe}class ae{static async closeHierarchyAsync(e,t,i,s){var n;let o=!0;if(i.requestClose||e.closeOnOutsideClick)for(const t of $.iterateBranch(e.branchId)){const e=await re().getPopup(t);if(o=null===(n=await(null==e?void 0:e.closeAsync(i,s)))||void 0===n||n,!o)break}o&&e.closeOnOutsideClick&&await e.closeAsync(i,s)}static async closeRootAsync(e,t,i,s){const n=w.findParent(e,(e=>P(e,(()=>["processCapturedPointerDownAsync","processCapturedKeyDownAsync"]))));if(n){if(i.requestClose=i.requestClose||e.closeOnOutsideClick,await n.processCapturedPointerDownAsync(t,i),i.handled)return}await ae.closeHierarchyAsync(e,t,i,s)}static async processCapturedPointerDown(e,t,i){if(i.nextInteractionHandled){if(!e.closeOnOutsideClick)return;await ae.closeHierarchyAsync(e,t,i,U.OutsideClick)}else await ae.closeRootAsync(e,t,i,U.OutsideClick)}}class he{constructor(){this.handlers=[],this.raise=e=>{this.handlers.slice(0).forEach((t=>t(e)))}}subscribe(e){this.handlers.push(e)}unsubscribe(e){this.handlers=this.handlers.filter((t=>t!==e))}}class le{constructor(){this.handlers=[]}subscribe(e){this.handlers.push(e)}unsubscribe(e){this.handlers=this.handlers.filter((t=>t!==e))}raise(e,t){this.handlers.slice(0).forEach((i=>i(e,t)))}}class de extends L{constructor(){super(...arguments),this._isCaptured=!1,this._locker=null}get locker(){return this._locker||(this._locker=new v)}get isCaptured(){return this._isCaptured}gotCapture(){this._isCaptured=!0}lostCapture(){this._isCaptured=!1}}var ce;const ue="dxbl-popup",pe=_();class me{constructor(e){this.closeReason=e}}class ge extends CustomEvent{constructor(e){super(ge.eventName,{detail:new me(e),bubbles:!0,composed:!0,cancelable:!0})}}ge.eventName=ue+".closingRequested",B.register(ge.eventName,(e=>e.detail));class be extends CustomEvent{constructor(e){super(be.eventName,{detail:new me(e),bubbles:!0,composed:!0,cancelable:!0})}}var fe,ve,Ce,ye,we,Pe,Te;be.eventName=ue+".closingResultRequested",B.register(be.eventName,(e=>e.detail)),function(e){e.Viewport="viewport",e.Page="page",e.Rectangle="rectangle",e.TargetElement="targetelement"}(fe||(fe={})),function(e){e.None="none",e.Hide="hide",e.Close="close"}(ve||(ve={})),function(e){e[e.TopLeft=0]="TopLeft",e[e.TopRight=1]="TopRight",e[e.BottomLeft=2]="BottomLeft",e[e.BottomRight=3]="BottomRight",e[e.Center=4]="Center"}(Ce||(Ce={}));class Re{constructor(e,t){this.targetInterestPoint=e,this.childInterestPoint=t}}!function(e){e.Absolute="absolute",e.Relative="relative",e.Bottom="bottom",e.Center="center",e.Right="right",e.AbsolutePoint="absolutepoint",e.RelativePoint="relativepoint",e.Mouse="mouse",e.MousePoint="mousepoint",e.Left="left",e.Top="top",e.Custom="custom"}(ye||(ye={})),function(e){e.Near="near",e.Far="far"}(we||(we={})),function(e){e.top="top",e.bottom="bottom"}(Pe||(Pe={})),function(e){e[e.None=0]="None",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(Te||(Te={}));class Ee{constructor(e=new o(0,0),t=new s(0,0)){this.childSize=s.Empty,this.mousePosition=null,this.visuallyHidden=!1,this.closingRequested=!1,this.lockPlacement=!1,this.lockedPosition=0,this.topLeft=e,this.size=t}}class xe{constructor(e,t,i,s,n){this.dropOpposite=!1,this.dropDirection=we.Near,this.dropAlignment=Pe.bottom,this.axis=t,this.point=e,this.dropOpposite=i,this.dropAlignment=n,this.dropDirection=s}}class Ie{get childPoints(){return this._childPoints}get placementTargetPoints(){return this._placementTargetPoints}constructor(e,t){this.customPlacement=null,this._childPoints=e,this._placementTargetPoints=t}}class He extends CustomEvent{constructor(e){super(He.eventName,{detail:e,bubbles:!0,composed:!1,cancelable:!0})}}He.eventName="dxbl-popup-custom-placement";class Ne{}class Le extends CustomEvent{constructor(e){super(Le.eventName,{detail:e,bubbles:!0,composed:!1,cancelable:!0})}}Le.eventName="dxbl-popup-shown";class _e extends CustomEvent{constructor(e){super(_e.eventName,{detail:e,bubbles:!0,composed:!1,cancelable:!0})}}_e.eventName="dxbl-popup-closed";class Be{get zIndex(){return this._zIndex}constructor(e){this._zIndex=null!=e?e:0}}class Oe extends CustomEvent{constructor(e){super(Oe.eventName,{detail:e,bubbles:!0,composed:!0})}}Oe.eventName="dxbl-popup-zindex-delta-change";class ze{get isFocused(){return this._isFocused}get branchId(){return this._branchId}constructor(e,t){this._branchId=e,this._isFocused=t}}class Se extends CustomEvent{constructor(e){super(Se.eventName,{detail:e,bubbles:!0,composed:!0})}}Se.eventName="dxbl-popup-focus-change";let De=ce=class extends de{get branchType(){return j.DropDown}get positionChanged(){return this._positionChangedEvent}get initialVisibility(){return this._initialVisibility}set initialVisibility(e){this._initialVisibility=e,this.style.visibility=this._initialVisibility?"visible":"hidden"}static get styles(){return E`
            :host {
                display: flex;
                flex: 1 1 auto;
                flex-direction: column;
                min-height: 0;
            }
            dxbl-branch {
                display: flex;
                flex: 1 1 auto;
                flex-direction: column;
                min-height: 0;
            }
            .content-holder {
                display: flex;
                flex: 1 0 auto;
                flex-direction: column;
                min-height: 0;
            }
        `}get renderedVisible(){var e,t;return this._renderedVisible&&(null===(t=null===(e=this._parentPopup)||void 0===e?void 0:e.renderedVisible)||void 0===t||t)}updated(e){e.has("closeOnOutsideClick")&&this.processCapture(this.closeOnOutsideClick),this.reposition()}get child(){return this._child}get isOpen(){return this._isOpen}get placementTargetElement(){return this.placementTargetElementField}set placementTargetElement(e){this.unsubscribeFromPlacementTargetPositionObserver(),this.placementTargetElementField=e,this.subscribeToPlacementTargetPositionObserver()}get dropOpposite(){return this._dropOpposite}get autoFocus(){return this._autoFocus}get dropFromRight(){return this._dropFromRight}get offset(){return this._offset}set offset(e){this._offset=e,this.style.transform=a.translateByPoint(e)}get childSize(){return this.positionInfo.childSize}constructor(){super(),this._renderedVisible=!1,this.hasOwnLogicalParent=!1,this.tolerance=.01,this.repositionAction=new n,this.positionInfo=new Ee,this._child=null,this.childResizeObserver=new ResizeObserver(this.handleChildSizeChanged.bind(this)),this._dropOpposite=!1,this._dropFromRight=!1,this._offset=o.zero,this.placementTargetElementField=null,this.focusInHandler=this.handleFocusIn.bind(this),this.focusOutHandler=this.handleFocusOut.bind(this),this.positionChangingHandler=this.handlePositionChanging.bind(this),this.sizeChangedHandler=this.handleSizeChanged.bind(this),this.placementTargetPositionChangedHandler=this.handlePlacementTargetPositionChanged.bind(this),this.placementTargetPositionObserver=new k(this.placementTargetPositionChangedHandler,{raf:!1}),this.placementTargetElementChangedHandler=this.handlePlacementTargetElementChanged.bind(this),this.placementTargetObserver=null,this._autoFocus=!1,this._interceptor=null,this.bridgeSlotChangedHandler=this.handleBridgeSlotChange.bind(this),this.closingResultRequestedTcs=new F,this._positionChangedEvent=new le,this._parentPopup=null,this.positionChangedHandler=this.handleParentPopupPositionChanged.bind(this),this._initialVisibility=!0,this.isAdjustDialogEnabled=!0,this.closeOnOutsideClick=!1,this.preventCloseOnPositionTargetClick=!1,this.closeMode=ve.Hide,this.fitToRestriction=!1,this.preventInteractions=!1,this.hasServerSideClosing=!1,this.parentBranchId=null,this.rootCssStyle=null,this.placement=ye.Absolute,this.horizontalOffset=0,this.verticalOffset=0,this.placementTarget=null,this.restrictTarget=null,this.restrict=fe.Viewport,this.width=null,this.maxWidth=null,this.minWidth=null,this.height=null,this.maxHeight=null,this.minHeight=null,this.desiredWidth=null,this.desiredHeight=null,this.minDesiredWidth=null,this.minDesiredHeight=null,this.renderWidth=null,this.renderHeight=null,this.restrictRectangle=t.Empty,this.placementRectangle=t.Empty,this.actualDropDirection=we.Near,this.actualDropAlignment=Pe.bottom,this.actualDropOpposite=!1,this._isOpen=!1,this.animationEnabled=!1,this.resizing=!1}render(){return this.renderTemplate()}willUpdate(e){this.renderWidth=this.calcRenderWidth(),this.renderHeight=this.calcRenderHeight(),this.shouldUpdateRootCssStyle(e)&&(this.rootCssStyle=this.composeRootCssStyle()),e.has(pe("placementTarget"))&&this.processPlacementTargetChanged()}composeRootCssStyle(){let e="";return this.shouldCalcWidth()&&(e+=`width: ${this.calcWidth()}; `),this.shouldCalcMinWidth()&&(e+=`min-width: ${this.calcMinWidth()}; `),this.shouldCalcMaxWidth()&&(e+=`max-width: ${this.calcMaxWidth()}; `),this.shouldCalcHeight()&&(e+=`height: ${this.calcHeight()}; `),this.shouldCalcMinHeight()&&(e+=`min-height: ${this.calcMinHeight()}; `),this.shouldCalcMaxHeight()&&(e+=`max-height: ${this.calcMaxHeight()}; `),e}processPlacementTargetChanged(){this.unsubscribeFromPlacementTargetObserver(),this.unsubscribeFromPlacementTargetPositionObserver(),this.subscribeToPlacementTargetObserver(),this.subscribeToPlacementTargetPositionObserver()}calcRenderHeight(){var e;return null!==(e=this.desiredHeight)&&void 0!==e?e:this.height}calcRenderWidth(){var e;return null!==(e=this.desiredWidth)&&void 0!==e?e:this.width}calcMaxWidth(){return this.maxWidth}calcMaxHeight(){return this.maxHeight}calcMinWidth(){var e;return null!==(e=this.minDesiredWidth)&&void 0!==e?e:this.minWidth}calcMinHeight(){var e;return null!==(e=this.minDesiredHeight)&&void 0!==e?e:this.minHeight}shouldCalcMinHeight(){return!!this.minHeight||!!this.minDesiredHeight}shouldCalcMinWidth(){return!!this.minWidth||!!this.minDesiredWidth}shouldCalcMaxWidth(){return!!this.maxWidth}shouldCalcMaxHeight(){return!!this.maxHeight}shouldCalcWidth(){return!!this.renderWidth}shouldCalcHeight(){return!!this.renderHeight}calcWidth(){return this.renderWidth}calcHeight(){return this.renderHeight}shouldUpdateRootCssStyle(e){return e.has("width")||e.has("minWidth")||e.has("maxWidth")||e.has("height")||e.has("minHeight")||e.has("maxHeight")||e.has("desiredWidth")||e.has("desiredHeight")||e.has("renderWidth")||e.has("renderHeight")||e.has("minDesiredWidth")||e.has("minDesiredHeight")}renderTemplate(){return x`
            <div class="${this.rootCssStyle}">
                ${this.renderSlot}
            </div>
        `}renderSlot(){return x`
            ${this.renderDefaultSlot()}
            ${this.renderAdditionalSlots()}
            ${this.renderBridgeSlot()}
        `}renderDefaultSlot(){return x`<slot></slot>`}renderBridgeSlot(){return x`
            <slot name="bridge" @slotchange=${this.bridgeSlotChangedHandler}></slot>
        `}renderAdditionalSlots(){return x`
            <slot name="top-left" slot="top-left"></slot>
            <slot name="top-right" slot="top-right"></slot>
            <slot name="bottom-left" slot="bottom-left"></slot>
            <slot name="bottom-right" slot="bottom-right"></slot>
        `}firstUpdated(){this.child&&(this.childResizeObserver.observe(this.child),this.reposition())}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this.close()}handleBridgeSlotChange(e){const t=e.target.assignedNodes();this._interceptor=t[0]}async processCapturedPointerDownAsync(e,t){t.handled||(t.nextInteractionHandled=t.nextInteractionHandled||this.preventInteractions,N.containsInComposedPath(e,this)||this.shouldCloseOnPlacementTargetClick(e)||await ae.processCapturedPointerDown(this,e,t))}shouldCloseOnPlacementTargetClick(e){return!(!this.preventCloseOnPositionTargetClick||!this.placementTargetElement)&&y.containsInComposedPath(e,(e=>e===this.placementTargetElement))}async closeAsync(e,t){const i=await this.raiseClosingResultRequestedAsync(t);return this.closingResultRequestedTcs=new F,e.nextInteractionHandled=e.nextInteractionHandled||this.preventInteractions,e.handled=!0,Promise.resolve(!!i)}async closeHierarchyAsync(e,t,i){await ae.closeHierarchyAsync(this,e,t,i)}async closeRootAsync(e,t,i){await ae.closeRootAsync(this,e,t,i)}async processCapturedKeyDownAsync(e,t){if(await super.processCapturedKeyDownAsync(e,t),!t.handled&&"Escape"===e.key&&this.canProcessEscapeKeyDown()){y.markHandled(e);const i=await this.raiseClosingResultRequestedAsync(U.EscapePress);if(this.closingResultRequestedTcs=new F,!i)return void(t.handled=!0);C.releaseCapture(this)}}canProcessEscapeKeyDown(){return!0}lostCapture(){super.lostCapture()}gotCapture(){super.gotCapture(),this.activate()}raiseEvent(e,t){var i;null===(i=this._interceptor)||void 0===i||i.raise(e,t)}unsubscribeFromPlacementTargetObserver(){this.placementTargetObserver&&(this.placementTargetObserver.disconnect(),this.placementTargetObserver=null)}subscribeToPlacementTargetObserver(){this.isOpen&&(this.placementTargetObserver=new M(this.placementTarget,this.placementTargetElementChangedHandler),this.placementTargetObserver.observe())}unsubscribeFromPlacementTargetPositionObserver(){this.placementTargetPositionObserver.disconnect()}subscribeToParentPopup(){const e=w.findParent(this,(e=>P(e,(()=>["closeHierarchyAsync","closeAsync","processCapturedPointerDownAsync","addEventListener","removeEventListener","contains","focus","positionChanged","renderedVisible"]))));if(e&&P(e,(()=>["closeHierarchyAsync","closeAsync","processCapturedPointerDownAsync","addEventListener","removeEventListener","contains","focus","positionChanged","renderedVisible"]))){const t=e;t.positionChanged.subscribe(this.positionChangedHandler),this._parentPopup=t}}unsubscribeFromParentPopup(){this._parentPopup&&(this._parentPopup.positionChanged.unsubscribe(this.positionChangedHandler),this._parentPopup=null)}handleParentPopupPositionChanged(e,t){this.updatePosition()}subscribeToPlacementTargetPositionObserver(){this.placementTargetElement&&this.isOpen&&this.placementTargetPositionObserver.observe(this.placementTargetElement)}show(){this.isOpen||(this.initialVisibility=!1,this._isOpen=!0,this.raiseShown(),this.addToLogicalTree(),this.addToVisibleBranchTree(),this.subscribeEvents(),this.initializeCapture(),this.reposition(),this.canAdjustZIndexOnShow&&this.raiseAdjustZIndexRequest(!0))}get canAdjustZIndexOnShow(){return!0}ensureBranchId(){if(!this.branchId)throw new Error("branchId should not be null")}addToVisibleBranchTree(){this.ensureBranchId(),$.register(this.branchId)}removeFromVisibleBranchTree(){this.ensureBranchId(),$.unregister(this.branchId)}raiseShown(){const e=new Ne;this.dispatchEvent(new Le(e))}raiseClosed(){const e=new Ne;this.dispatchEvent(new _e(e))}close(){this.isOpen&&(this._isOpen=!1,this.raiseClosed(),this.removeFromLogicalTree(),this.removeFromVisibleBranchTree(),this.unsubscribeEvents(),this.releaseCapture(),this.cleanUpAfterClose(),this.reposition(),this.canAdjustZIndexOnShow&&this.raiseAdjustZIndexRequest(!1))}notifyCloseCanceled(){this.processClosingRequested(!1),this.positionInfo.closingRequested=!1}cleanUpAfterClose(){this.updateVisibility(!1),this.animationEnabled=!1,this.positionInfo=new Ee}shouldCapture(){return this.closeOnOutsideClick||this.preventInteractions}async addToLogicalTree(){if(this.hasLogicalParent)return void(this.hasOwnLogicalParent=!0);this.ensureBranchId();const e=Z.getParentId(this.branchId),t=await re().getPopup(e);t&&P(t,(()=>["logicalChildren","addLogicalChild","removeLogicalChild"]))&&t.addLogicalChild(this)}removeFromLogicalTree(){if(this.hasOwnLogicalParent)return void(this.hasOwnLogicalParent=!1);const e=w.getParent(this,!0);e&&P(e,(()=>["logicalChildren","addLogicalChild","removeLogicalChild"]))&&e.removeLogicalChild(this)}initializeCapture(){this.shouldCapture&&C.capture(this)}focusCapture(){this.shouldCapture&&C.capture(this,!1)}releaseCapture(){this.processClosingRequested(!0),C.releaseCapture(this)}processClosingRequested(e){this.closingResultRequestedTcs.resolve(e),this.closingResultRequestedTcs=new F,this.positionInfo.closingRequested=!1}subscribeToChild(e){e&&this.childResizeObserver.observe(e,{box:"border-box"})}unsubscribeFromChild(e){e&&this.childResizeObserver.unobserve(e)}subscribeEvents(){this.isAdjustDialogEnabled&&(this.addEventListener("focusin",this.focusInHandler),this.addEventListener("focusout",this.focusOutHandler)),document.addEventListener(d.eventName,this.positionChangingHandler),this.addEventListener(d.eventName,this.positionChangingHandler),window.addEventListener("resize",this.sizeChangedHandler),this.subscribeToPlacementTargetObserver(),this.subscribeToPlacementTargetPositionObserver(),this.subscribeToParentPopup()}unsubscribeEvents(){this.isAdjustDialogEnabled&&(this.removeEventListener("focusin",this.focusInHandler),this.removeEventListener("focusout",this.focusOutHandler)),document.removeEventListener(d.eventName,this.positionChangingHandler),this.removeEventListener(d.eventName,this.positionChangingHandler),this.removeEventListener("resize",this.sizeChangedHandler),this.unsubscribeFromPlacementTargetPositionObserver(),this.unsubscribeFromPlacementTargetObserver(),this.unsubscribeFromParentPopup()}reposition(){this.repositionAction.execute(this.updatePosition.bind(this))}activate(){const e=new g(new f(this.branchId));this.dispatchEvent(e)}forceReposition(){this.repositionAction.cancel(),this.updatePosition()}lockPlacement(){this.positionInfo.lockPlacement=!0}unlockPlacement(){this.positionInfo.lockPlacement=!1}handleChildSizeChanged(e,t){this.reposition(),this.initialVisibility||(this.initialVisibility=!0)}handlePositionChanging(e){this.reposition()}handleSizeChanged(e){this.reposition()}handlePlacementTargetPositionChanged(e,t){this.reposition()}handlePlacementTargetElementChanged(e,t){this.placementTargetElement=e.element,this.reposition()}handleFocusIn(e){this.raiseAdjustZIndexRequest(!0)}handleFocusOut(e){this.raiseAdjustZIndexRequest(!1)}raiseAdjustZIndexRequest(e){this.dispatchEvent(new Se(new ze(this.branchId,e))),e&&this.focusCapture()}isAbsolutePlacementMode(e){switch(e){case ye.MousePoint:case ye.Mouse:case ye.AbsolutePoint:case ye.Absolute:return!0}return!1}interestPointsFromRect(e){const t=new Array(5);return t[Ce.TopLeft]=e.topLeft,t[Ce.TopRight]=e.topRight,t[Ce.BottomLeft]=e.bottomLeft,t[Ce.BottomRight]=e.bottomRight,t[Ce.Center]=new o(e.x+e.width/2,e.y+e.height/2),t}getPlacementTargetInterestPoints(e){let n,a=t.Empty;const l=this.placementTargetElement,d=new z(this.horizontalOffset,this.verticalOffset);if(!l||this.isAbsolutePlacementMode(e))e!==ye.Mouse&&e!==ye.MousePoint||(this.positionInfo.mousePosition||(this.positionInfo.mousePosition=new o(O.x,O.y)),a=t.create(this.positionInfo.mousePosition,s.Empty)),a=i.offset(a,d),n=this.interestPointsFromRect(a);else{a=this.placementRectangle,i.areSame(a,t.Empty)&&(a=e!==ye.Relative&&e!==ye.RelativePoint?new t(0,0,l.offsetWidth,l.offsetHeight):t.Empty),a=i.offset(a,d),n=this.interestPointsFromRect(a);const s=h.getRelativeElementRect(l).topLeft;for(let e=0;e<5;e++)n[e]=r.add(n[e],s)}return n}getChildInterestPoints(e){return this.interestPointsFromRect(this.child?new t(0,0,this.child.offsetWidth,this.child.offsetHeight):t.Empty)}getBounds(e){let i=e[0].x,s=e[0].x,n=e[0].y,o=e[0].y;return e.forEach((e=>{const t=e.x,r=e.y;t<i&&(i=t),t>s&&(s=t),r<n&&(n=r),r>o&&(o=r)})),new t(i,n,s-i,o-n)}raiseCustomPlacement(e,t){const i=new He(new Ie(e,t));return this.dispatchEvent(i),i.detail.customPlacement}getNumberOfCombinations(e){switch(e){case ye.Mouse:return 2;case ye.Bottom:case ye.Top:case ye.Right:case ye.Left:case ye.RelativePoint:case ye.MousePoint:case ye.AbsolutePoint:return 4;case ye.Custom:return 0;default:return 1}}getPointCombination(e,t){const i=this.dropFromRight;switch(e){case ye.Mouse:if(i){if(0===t)return[new Re(Ce.BottomRight,Ce.TopRight),Te.Horizontal,!1,we.Near,Pe.bottom];if(1===t)return[new Re(Ce.TopRight,Ce.BottomRight),Te.Horizontal,!1,we.Near,Pe.bottom]}else{if(0===t)return[new Re(Ce.BottomLeft,Ce.TopLeft),Te.Horizontal,!1,we.Near,Pe.bottom];if(1===t)return[new Re(Ce.TopLeft,Ce.BottomLeft),Te.Horizontal,!1,we.Near,Pe.bottom]}break;case ye.Bottom:if(i){if(0===t)return[new Re(Ce.BottomRight,Ce.TopRight),Te.Horizontal,!1,we.Far,Pe.bottom];if(1===t)return[new Re(Ce.TopRight,Ce.BottomRight),Te.Horizontal,!0,we.Far,Pe.top];if(2===t)return[new Re(Ce.BottomLeft,Ce.TopLeft),Te.Horizontal,!1,we.Near,Pe.bottom];if(3===t)return[new Re(Ce.TopLeft,Ce.BottomLeft),Te.Horizontal,!0,we.Near,Pe.top]}else{if(0===t)return[new Re(Ce.BottomLeft,Ce.TopLeft),Te.Horizontal,!1,we.Near,Pe.bottom];if(1===t)return[new Re(Ce.TopLeft,Ce.BottomLeft),Te.Horizontal,!0,we.Near,Pe.top];if(2===t)return[new Re(Ce.BottomRight,Ce.TopRight),Te.Horizontal,!1,we.Far,Pe.bottom];if(3===t)return[new Re(Ce.TopRight,Ce.BottomRight),Te.Horizontal,!0,we.Far,Pe.top]}break;case ye.Top:if(i){if(0===t)return[new Re(Ce.TopRight,Ce.BottomRight),Te.Horizontal,!1,we.Far,Pe.top];if(1===t)return[new Re(Ce.BottomRight,Ce.TopRight),Te.Horizontal,!0,we.Far,Pe.bottom];if(2===t)return[new Re(Ce.TopLeft,Ce.BottomLeft),Te.Horizontal,!1,we.Near,Pe.top];if(3===t)return[new Re(Ce.BottomLeft,Ce.TopLeft),Te.Horizontal,!0,we.Near,Pe.bottom]}else{if(0===t)return[new Re(Ce.TopLeft,Ce.BottomLeft),Te.Horizontal,!1,we.Near,Pe.top];if(1===t)return[new Re(Ce.BottomLeft,Ce.TopLeft),Te.Horizontal,!0,we.Near,Pe.bottom];if(2===t)return[new Re(Ce.TopRight,Ce.BottomRight),Te.Horizontal,!1,we.Far,Pe.top];if(3===t)return[new Re(Ce.BottomRight,Ce.TopRight),Te.Horizontal,!0,we.Far,Pe.bottom]}break;case ye.Right:case ye.Left:if(i&&e===ye.Right||!i&&e===ye.Left){if(0===t)return[new Re(Ce.TopLeft,Ce.TopRight),Te.Vertical,!1,we.Near,Pe.bottom];if(1===t)return[new Re(Ce.BottomLeft,Ce.BottomRight),Te.Vertical,!0,we.Near,Pe.top];if(2===t)return[new Re(Ce.TopRight,Ce.TopLeft),Te.Vertical,!1,we.Far,Pe.bottom];if(3===t)return[new Re(Ce.BottomRight,Ce.BottomLeft),Te.Vertical,!0,we.Far,Pe.top]}else{if(0===t)return[new Re(Ce.TopRight,Ce.TopLeft),Te.Vertical,!1,we.Near,Pe.bottom];if(1===t)return[new Re(Ce.BottomRight,Ce.BottomLeft),Te.Vertical,!0,we.Near,Pe.top];if(2===t)return[new Re(Ce.TopLeft,Ce.TopRight),Te.Vertical,!1,we.Far,Pe.bottom];if(3===t)return[new Re(Ce.BottomLeft,Ce.BottomRight),Te.Vertical,!0,we.Far,Pe.top]}break;case ye.Relative:case ye.RelativePoint:case ye.MousePoint:case ye.AbsolutePoint:if(i){if(0===t)return[new Re(Ce.TopLeft,Ce.TopRight),Te.Horizontal,!1,we.Far,Pe.bottom];if(1===t)return[new Re(Ce.TopLeft,Ce.TopLeft),Te.Horizontal,!1,we.Near,Pe.bottom];if(2===t)return[new Re(Ce.TopLeft,Ce.BottomRight),Te.Horizontal,!0,we.Far,Pe.top];if(3===t)return[new Re(Ce.TopLeft,Ce.BottomLeft),Te.Horizontal,!0,we.Near,Pe.top]}else{if(0===t)return[new Re(Ce.TopLeft,Ce.TopLeft),Te.Horizontal,!1,we.Near,Pe.bottom];if(1===t)return[new Re(Ce.TopLeft,Ce.TopRight),Te.Horizontal,!1,we.Far,Pe.bottom];if(2===t)return[new Re(Ce.TopLeft,Ce.BottomLeft),Te.Horizontal,!0,we.Near,Pe.top];if(3===t)return[new Re(Ce.TopLeft,Ce.BottomRight),Te.Horizontal,!0,we.Far,Pe.top]}break;case ye.Center:return[new Re(Ce.Center,Ce.Center),Te.None,!1,we.Near,Pe.bottom];default:return[new Re(Ce.TopLeft,Ce.TopLeft),Te.None,!1,we.Near,Pe.bottom]}return[new Re(Ce.TopLeft,Ce.TopLeft),Te.None,!1,we.Near,Pe.bottom]}getRestrictBounds(){switch(this.restrict){case fe.Viewport:return D.viewport();case fe.Page:return D.page();case fe.TargetElement:{if(!this.restrictTarget)throw new Error("restrictTarget should be specified if restrictmode is custom");const e=document.querySelector(this.restrictTarget);return h.getRelativeElementRect(e)}case fe.Rectangle:return this.restrictRectangle}return D.viewport()}updatePosition(){if(!this.isOpen)return this._renderedVisible=!1,void(this.style.display=c.none);const e=this.renderedVisible;this._renderedVisible=!0;const t=this.renderedVisible;if(!t)return this.updateVisibility(!0),void(e!==t&&this.raisePositionChanged(this.offset,!1));this.style.display=c.flex;const s=this.placement,n=this.getPlacementTargetInterestPoints(s),a=this.getChildInterestPoints(s),h=this.getBounds(n);let l=this.getBounds(a);const d=l.width*l.height;let u=-1,p=new z(this.positionInfo.topLeft.x,this.positionInfo.topLeft.y),m=!1,g=-1,b=Te.None,f=0,v=this.actualDropDirection,C=this.actualDropOpposite,y=this.actualDropAlignment,w=null,P=null;s===ye.Custom?(P=this.processCustomPlacement(a,n),f=P?P.length:0):f=this.getNumberOfCombinations(s);for(let e=0;e<f;e++){if(this.positionInfo.lockPlacement&&this.positionInfo.lockedPosition!==e)continue;let t=new z(0,0),o=Te.None,h=!1,c=we.Near,m=Pe.bottom,f=null;if(s===ye.Custom)f=P[e],t=S.add(n[Ce.TopLeft],f.point),o=f.axis,h=f.dropOpposite,c=f.dropDirection,m=f.dropAlignment;else{const[i,o,l,d,u]=this.getPointCombination(s,e);h=l,c=d,m=u,t=r.sub(n[i.targetInterestPoint],a[i.childInterestPoint])}const T=i.offset(l,t),R=this.getRestrictBounds(),E=i.intersect(R,T),x=E.isEmpty?0:E.width*E.height;if(x-g>this.tolerance&&(u=e,p=t,g=x,b=o,v=c,C=h,y=m,w=f,Math.abs(x-d)<this.tolerance))break}this.actualDropOpposite=C,this.actualDropDirection=v,this.actualDropAlignment=y,l=i.offset(l,p);const T=this.getRestrictBounds(),R=i.intersect(T,l);[p,m]=this.calcRestrictedBestTranslation(R,l,n,T,h,p),this.processBestTranslationResults(p,l,h,T,C,v,y,b,w),this.positionInfo.lockedPosition=u,this.positionInfo.childSize=l.size;const E=Math.round(p.x),x=Math.round(p.y);let I=!1;E===this.positionInfo.topLeft.x&&x===this.positionInfo.topLeft.y||(this.positionInfo.topLeft=new o(E,x),this.offset=this.positionInfo.topLeft,I=!0);const H=!t||m,N=this.updateVisibility(H);I=I||N,this.animationEnabled=t&&!m,I&&this.raisePositionChanged(this.offset,H),this.closeMode===ve.Close&&!this.positionInfo.closingRequested&&H&&(this.positionInfo.closingRequested=!0,this.raiseClosingRequested(U.Programmatically))}raisePositionChanged(e,t){this._positionChangedEvent.raise(this,[!t,e])}updateVisibility(e){return this._renderedVisible=!e,this.positionInfo.visuallyHidden!==e&&(this.style.opacity=e?"0":"1",this.positionInfo.visuallyHidden=e,!0)}processCustomPlacement(e,t){return this.raiseCustomPlacement(e,t)}raiseClosingRequested(e){this.dispatchEvent(new ge(e))}raiseClosingResultRequested(e){this.dispatchEvent(new be(e))}async raiseClosingResultRequestedAsync(e){if(!this.hasServerSideClosing)return this.raiseClosingRequested(e),!0;const t=new F;return this.closingResultRequestedTcs=t,this.raiseClosingResultRequested(e),t.promise}calcRestrictedBestTranslation(e,t,i,s,n,o){return[this.fitToRestriction?this.calcRestrictedFitBestTranslation(e,t,i,s,o):o,this.closeMode!==ve.None&&this.calcRestrictedShouldHide(s,n)]}calcRestrictedShouldHide(e,t){if(!this.placementTargetElement)return!ce.checkTargetEdgesWithin(e,t);let s=e;return h.getClippingParents(this.placementTargetElement).forEach((e=>{const t=h.getRelativeElementRect(e);s=i.intersect(s,t)})),!!s.isEmpty||!ce.checkTargetEdgesWithin(s,t)}static checkTargetEdgesWithin(e,t){return i.contains(e,t.topLeft)||i.contains(e,t.topRight)||i.contains(e,t.bottomLeft)||i.contains(e,t.bottomRight)}calcRestrictedFitBestTranslation(e,t,i,s,n){if(Math.abs(e.width-t.width)>this.tolerance||Math.abs(e.height-t.height)>this.tolerance){const e=i[Ce.TopLeft],o=r.sub(i[Ce.TopRight],e),a=S.normalize(new z(o.x,o.y));Number.isNaN(a.y)||Math.abs(a.y)<this.tolerance?t.right>s.right?n=new z(s.right-t.width,n.y):t.left<s.left&&(n=new z(s.left,n.y)):Math.abs(a.x)<this.tolerance&&(t.bottom>s.bottom?n=new z(n.x,s.bottom-t.bottom):t.top<s.top&&(n=new z(n.x,s.top)));const h=r.sub(e,i[Ce.BottomLeft]),l=S.normalize(h);Number.isNaN(l.x)||Math.abs(l.x)<this.tolerance?t.bottom>s.bottom?n=new z(n.x,s.bottom-t.height):t.top<s.top&&(n=new z(n.x,s.top)):Math.abs(l.y)<this.tolerance&&(t.right>s.right?n=new z(s.right-t.width,n.y):t.left<s.left&&(n=new z(s.x,n.y)))}return n}processCapture(e){}processBestTranslationResults(e,t,i,s,n,o,r,a,h){}};function Ae(){}function ke(e){if(!e)throw new Error("failed");return e}e([I({type:Boolean,attribute:"close-on-outside-click"})],De.prototype,"closeOnOutsideClick",void 0),e([I({type:Boolean,attribute:"prevent-close-on-position-target-click"})],De.prototype,"preventCloseOnPositionTargetClick",void 0),e([I({type:String,attribute:"close-mode"})],De.prototype,"closeMode",void 0),e([I({type:Boolean,attribute:"fit-to-restriction"})],De.prototype,"fitToRestriction",void 0),e([I({type:Boolean,attribute:"prevent-interactions"})],De.prototype,"preventInteractions",void 0),e([I({type:Boolean,attribute:"has-serverside-closing"})],De.prototype,"hasServerSideClosing",void 0),e([I({type:String,attribute:"branch-id"})],De.prototype,"branchId",void 0),e([I({type:String,attribute:"parent-branch-id"})],De.prototype,"parentBranchId",void 0),e([I({type:String,reflect:!1})],De.prototype,"rootCssStyle",void 0),e([I({type:String,attribute:"placement"})],De.prototype,"placement",void 0),e([I({type:Number,attribute:"horizontal-offset"})],De.prototype,"horizontalOffset",void 0),e([I({type:Number,attribute:"vertical-offset"})],De.prototype,"verticalOffset",void 0),e([I({type:String,attribute:"placement-target"})],De.prototype,"placementTarget",void 0),e([I({type:String,attribute:"restrict-target"})],De.prototype,"restrictTarget",void 0),e([I({type:String,attribute:"restrict"})],De.prototype,"restrict",void 0),e([I({type:String,attribute:"width"})],De.prototype,"width",void 0),e([I({type:String,attribute:"max-width"})],De.prototype,"maxWidth",void 0),e([I({type:String,attribute:"min-width"})],De.prototype,"minWidth",void 0),e([I({type:String,attribute:"height"})],De.prototype,"height",void 0),e([I({type:String,attribute:"max-height"})],De.prototype,"maxHeight",void 0),e([I({type:String,attribute:"min-height"})],De.prototype,"minHeight",void 0),e([I({type:String,attribute:"desired-width"})],De.prototype,"desiredWidth",void 0),e([I({type:String,attribute:"desired-height"})],De.prototype,"desiredHeight",void 0),e([I({type:String,attribute:"min-desired-width"})],De.prototype,"minDesiredWidth",void 0),e([I({type:String,attribute:"min-desired-height"})],De.prototype,"minDesiredHeight",void 0),e([I({type:String,reflect:!1})],De.prototype,"renderWidth",void 0),e([I({type:String,reflect:!1})],De.prototype,"renderHeight",void 0),e([I({type:String,attribute:"restrict-rect",converter:e=>e?i.parse(e):t.Empty})],De.prototype,"restrictRectangle",void 0),e([I({type:String,attribute:"placement-rect",converter:e=>e?i.parse(e):t.Empty})],De.prototype,"placementRectangle",void 0),e([I({type:String,attribute:"x-drop-direction",reflect:!0})],De.prototype,"actualDropDirection",void 0),e([I({type:String,attribute:"x-drop-alignment",reflect:!0})],De.prototype,"actualDropAlignment",void 0),e([I({type:String,attribute:"x-drop-opposite",reflect:!0,converter:{toAttribute:(e,t)=>e?"true":"false"}})],De.prototype,"actualDropOpposite",void 0),e([I({type:Boolean,attribute:"x-is-open",reflect:!0,converter:{fromAttribute:(e,t)=>{throw new Error("readonly")}}})],De.prototype,"_isOpen",void 0),e([I({type:Boolean,reflect:!1})],De.prototype,"animationEnabled",void 0),e([I({type:Boolean,attribute:"resizing"})],De.prototype,"resizing",void 0),De=ce=e([H(ue)],De);const Me=Object.freeze({__proto__:null,dxPopupTagName:ue,PopupClosingRequestedEvent:ge,PopupClosingResultRequestedEvent:be,get CloseMode(){return ve},get InterestPoint(){return Ce},get PlacementMode(){return ye},get DropDirection(){return we},get DropAlignment(){return Pe},get PopupPrimaryAxis(){return Te},CustomPopupPlacement:xe,CustomPlacementEvent:He,PopupContext:Ne,PopupShownEvent:Le,PopupClosedEvent:_e,ZIndexDeltaChangeContext:Be,PopupZIndexDeltaChangeEvent:Oe,PopupAdjustZIndexRequestContext:ze,PopupAdjustZIndexRequestEvent:Se,get DxPopup(){return De},init:Ae,getReference:ke,default:{init:Ae,getReference:ke,dxPopupTagName:ue,DxPopup:De}});export{j as B,ve as C,we as D,Ce as I,ye as P,he as S,F as T,z as V,Be as Z,xe as a,Te as b,Pe as c,Oe as d,De as e,G as f,Y as g,Le as h,_e as i,de as j,le as k,Se as l,ze as m,ae as n,U as o,re as p,ie as q,Q as r,Me as s,$ as v};
