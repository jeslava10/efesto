import{d as e}from"./dom-f93f7533.js";import{D as t}from"./dx-html-element-base-3906936e.js";import{C as n}from"./css-classes-f3f8ed66.js";import{H as i,P as a,a as s,b as l}from"./dx-html-element-pointer-events-helper-4b46ddbf.js";import{R as r}from"./rect-00eb3fa4.js";import{C as o}from"./custom-events-helper-18f7786a.js";import{b as d}from"./constants-2d0e11b4.js";import"./_tslib-6e8ca86b.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-8570b930.js";import"./pointer-event-helper-ba4ce1e1.js";import"./constants-58283e53.js";import"./point-e4ec110e.js";class c{}c.Prefix=n.Prefix+"-calendar",c.SelectedItem=c.Prefix+"-selected-item",c.SelectedRange=c.Prefix+"-selected-range",c.Content=c.Prefix+"-content";class h{constructor(e){this._pointerDownDate=e.pointerDownDate,this._pointerUpDate=null,this._clearSelection=e.clearSelection,this.dayCellElements=e.dayCellElements,this.refreshUI(!1)}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate!==e&&e&&(this._pointerUpDate=e,this.refreshUI(!0))}get isValid(){return!!this._pointerUpDate}stop(){this.refreshUI(!1)}cancel(){for(let e=0;e<this.dayCellElements.length;e++){const t=this.dayCellElements[e];h.removeDayCellSelectedClasses(t),t.hasAttribute("data-selected")&&h.addSelectedClassesToCell(t)}}refreshUI(t){const n=this.getStartPointedDateRange(),i=this.getEndPointedDateRange();for(let a=0;a<this.dayCellElements.length;a++){const s=this.dayCellElements[a];if(this.isDateCellDisabled(s))continue;const l=Number(s.dataset.date);h.removeDayCellSelectedClasses(s),t&&this.isDateRangeBoundary(l,n,i)&&e.DomUtils.addClassName(s,c.SelectedRange),this.needApplySelectedStyle(l,n,i,t)&&h.addSelectedClassesToCell(s),s.hasAttribute("data-selected")&&!this.clearSelection&&h.addSelectedClassesToCell(s)}}getStartPointedDateRange(){return this.pointerUpDate?Math.min(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}getEndPointedDateRange(){return this.pointerUpDate?Math.max(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}needApplySelectedStyle(e,t,n,i){return!(e<t||e>n)&&(!i||!this.isDateRangeBoundary(e,t,n))}isDateRangeBoundary(e,t,n){if(!this.isDateDisabled(e)&&(e===t||e===n))return!0;return!(!(e>t&&e<n)||e!==this.getBoundaryDate(t,e)&&e!==this.getBoundaryDate(n,e))}getBoundaryDate(e,t){const n=e<t,i=n?1:-1;let a=e;for(;(n?a<t:a>t)&&this.isDateDisabled(a);)a+=i*h.getOneDayTime();return a}static getOneDayTime(){return 864e5}isDateCellDisabled(e){return e.hasAttribute("data-disabled")}isDateDisabled(e){const t=this.getDayCellByDay(e);return null!=t&&this.isDateCellDisabled(t)}getDayCellByDay(e){for(let t=0;t<this.dayCellElements.length;t++)if(this.dayCellElements[t].getAttribute("data-date")===e.toString())return this.dayCellElements[t];return null}static addSelectedClassesToCell(t){e.DomUtils.addClassName(t,c.SelectedItem)}static removeDayCellSelectedClasses(t){e.DomUtils.removeClassName(t,c.SelectedItem),e.DomUtils.removeClassName(t,c.SelectedRange),e.DomUtils.removeClassName(t,"text-white")}}class D{constructor(e,t){this._pointerDownDate=e,this._pointerUpDate=null,this._clearSelection=t}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate=e}get isValid(){var e;return this.pointerDownDate.getTime()===(null===(e=this.pointerUpDate)||void 0===e?void 0:e.getTime())}stop(){}cancel(){}}var p;!function(e){e[e.Month=0]="Month",e[e.Year=1]="Year",e[e.Years=2]="Years",e[e.Decades=3]="Decades"}(p||(p={}));class m extends CustomEvent{constructor(e,t,n){super(m.eventName,{detail:new u(e,t,n),bubbles:!0,composed:!0,cancelable:!0})}}m.eventName=d+".daycellpointerup";class u{constructor(e,t,n){this.PointerDownDate=e,this.PointerUpDate=t,this.ClearSelection=n}}o.register(m.eventName,(e=>e.detail));const b=document.createElement("template");b.innerHTML="\n<style></style>\n<slot />";const y="dxbl-calendar-day";class S extends t{constructor(){super(),this.boundOnStartDaySelectionHandler=this.onStartDaySelection.bind(this),this.boundOnStopDaySelectionHandler=this.onStopDaySelection.bind(this),this.boundOnCancelDaySelectionHandler=this.onCancelDaySelection.bind(this),this.boundOnDayCellPointerEnterHandler=this.onDayCellPointerEnter.bind(this),this._enableMultiSelect=!1,this.daySelectionRenderer=null,this.calendarTableResizeObserver=new ResizeObserver(this.onCalendarTableSizeChanged.bind(this))}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e}connectedCallback(){super.connectedCallback(),this.addEventSubscriptions()}initializeComponent(){super.initializeComponent(),this.fixCalendarTableSize()}disposeComponent(){this.removeEventSubscriptions(),super.disposeComponent()}disconnectedCallback(){this.calendarTableResizeObserver.disconnect(),super.disconnectedCallback()}fixCalendarTableSize(){const e=this.getCalendarTableElement();if(!e)return;e.style.width="",e.style.height="";const t=e.getBoundingClientRect();r.fromDomRect(t).isEmpty?this.calendarTableResizeObserver.observe(e):this.applyTableSize(e,t.width,t.height)}applyTableSize(e,t,n){e.style.width=t+"px",e.style.height=n+"px"}onCalendarTableSizeChanged(e){if(e.length<1)return;const t=e[0].target,n=e[0].contentRect;r.fromDomRect(n).isEmpty||(this.applyTableSize(t,n.width,n.height),this.calendarTableResizeObserver.disconnect())}addEventSubscriptions(){this.addEventListener(a.eventName,this.boundOnStartDaySelectionHandler),this.addEventListener(s.eventName,this.boundOnStopDaySelectionHandler),this.addEventListener(l.eventName,this.boundOnCancelDaySelectionHandler)}removeEventSubscriptions(){this.removeEventListener(a.eventName,this.boundOnStartDaySelectionHandler),this.removeEventListener(s.eventName,this.boundOnStopDaySelectionHandler),this.removeEventListener(l.eventName,this.boundOnCancelDaySelectionHandler)}addDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].addEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}removeDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].removeEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}onStartDaySelection(t){if(e.DomUtils.hasClassName(this,n.Disabled)||e.DomUtils.hasClassName(this,n.ReadOnly))return;const i=S.getDateFromTarget(t.detail.source.target);if(!i)return;this.daySelectionRenderer=this.createDaySelectionRenderer(i,!t.detail.isLongTap&&(!(t.detail.source.ctrlKey||t.detail.source.metaKey)||t.detail.isTouch)),this.addDayCellEventSubscriptions(),t.stopPropagation()}onStopDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=S.getDateFromTarget(e.detail.source.target),this.daySelectionRenderer.stop(),this.raiseSelectionChanged(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}onCancelDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.cancel(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}raiseSelectionChanged(){this.daySelectionRenderer&&this.daySelectionRenderer.isValid&&this.invokeDayCellPointerUp(this.daySelectionRenderer.pointerDownDate,this.daySelectionRenderer.pointerUpDate,this.daySelectionRenderer.clearSelection)}invokeDayCellPointerUp(e,t,n){this.dispatchEvent(new m(e,t,n))}onDayCellPointerEnter(e){if(!this.daySelectionRenderer)return;const t=S.getDateFromTarget(e.target);this.daySelectionRenderer.pointerUpDate=t}createDaySelectionRenderer(e,t){return this.enableMultiSelect?new h({pointerDownDate:e,clearSelection:t,dayCellElements:this.findDayCellElements()}):new D(e,t)}findDayCellElements(){return this.querySelectorAll(`.${y}`)}getCalendarTableElement(){return this.querySelector(`.${c.Content} > table`)}static getDateFromTarget(e){const t=S.getDayCellByTarget(e);return t?S.getDateFromCell(t):null}static getDayCellByTarget(t){const n=t;return n?e.DomUtils.hasClassName(n,y)?n:n.closest(`.${y}`):null}static getDateFromCell(e){return new Date(Number(e.getAttribute("data-date")))}getContentTemplate(){return b}static get observedAttributes(){return["class","enable-multi-select"]}attributeChangedCallback(e,t,n){switch(e){case"class":this.fixCalendarTableSize();break;case"enable-multi-select":this.enableMultiSelect=null!==n}}}customElements.define("dxbl-calendar",S),customElements.define("dxbl-calendar-table-container",class extends t{constructor(){super(),this._view=p.Month}get view(){return this._view}set view(e){this._view=e,this.handlePointerEventsMode=i.None,this.view===p.Month&&(this.handlePointerEventsMode=i.Click|i.Dragging)}static get observedAttributes(){return["view"]}attributeChangedCallback(e,t,n){if("view"===e)this.view=Number(n)}});const C={loadModule:function(){}};export{C as default};
