import{p as t,R as e,c as i}from"./dom-utils-04e3c6d2.js";import{d as n}from"./dom-f93f7533.js";import{E as s}from"./eventRegister-fb9b0e47.js";import{D as o}from"./dx-html-element-base-3906936e.js";import"./css-classes-f3f8ed66.js";import"./_tslib-6e8ca86b.js";import"./data-qa-utils-8be7c726.js";import"./dx-html-element-pointer-events-helper-4b46ddbf.js";import"./eventhelper-8570b930.js";import"./pointer-event-helper-ba4ce1e1.js";import"./constants-58283e53.js";const a="is-animating",h="data-items-container";var l;!function(t){t[t.None=0]="None",t[t.Slide=1]="Slide"}(l||(l={}));class r extends o{constructor(){super(),this.isAnimating=!1,this.mutationObserver=null,this._expanded=!0,this._animationType=l.None,this.events=new s(this),this.contentFirstRender=!0}get expanded(){return this._expanded}set expanded(t){this._expanded!==t&&(this._expanded=t,this.applyExpandedStateToElements())}get animationType(){return this._animationType}set animationType(t){this._animationType!==t&&(this._animationType=t)}initializeComponent(){const t=this.isInitialized;super.initializeComponent(),t&&!this.contentFirstRender||this.applyExpandedStateToElements()}notifyActualExpandedChanged(){this.dispatchEvent(new Event("change",{bubbles:!0}))}get value(){return Boolean(this.expanded).toString()}static get observedAttributes(){return["expanded-state","animation-type"]}attributeChangedCallback(t,e,i){switch(t){case"expanded-state":this.expanded="true"===(null==i?void 0:i.toLowerCase());break;case"animation-type":this.animationType=l[i]}}applyExpandedStateToElements(){var t;const e=this.expanded;if(!this.isInitialized)return this.notifyActualExpandedChanged(),void this.setContainerElementVisibility(e);if(this.animationType===l.None)return this.notifyActualExpandedChanged(),this.setContainerElementVisibility(e),void(this.contentFirstRender=!1);if(e&&0===this.childElementCount)return void this.waitForContent(this);if(e&&0!==this.childElementCount&&null!==this.firstElementChild&&this.firstElementChild.hasAttribute(h)&&0===this.firstElementChild.childElementCount)return void this.waitForContent(this.firstElementChild);this.contentFirstRender=!1;const i=this.token,n=e&&!i?0:this.getContainerStartHeight(e);this.toggleAttribute(a,!1),i&&(this.style.maxHeight=n+"px");const s=this.getContainerEndHeight(e);if(this.prepareElementsForAnimation(e,0,!!i),null===(t=this.token)||void 0===t||t.dispose(),this.token=null,n!==s){const t=()=>{this.token.dispose(),this.token=null,this.onAnimationComplete()};this.startAnimation(n,s,(()=>{t()}))}else this.onAnimationComplete()}waitForContent(t){var e;null===(e=this.mutationObserver)||void 0===e||e.disconnect(),this.mutationObserver=new MutationObserver((t=>{var e;this.applyExpandedStateToElements(),null===(e=this.mutationObserver)||void 0===e||e.disconnect()})),this.mutationObserver.observe(t,{childList:!0})}setContainerElementVisibility(t){this.setElementVisibility(t)}setElementVisibility(t){t?(this.style.display="",this.style.height=""):(this.style.display="none",this.style.height="0px")}getContainerStartHeight(t){return t?this.getClearClientHeight():this.offsetHeight}getContainerEndHeight(t){if(!t)return 0;const e=this.getClearClientHeight(),i=this.getElementVisibility(!1);this.style.maxHeight="",this.setElementVisibility(!0);const n=this.getClearClientHeight();return this.setElementVisibility(i),this.style.maxHeight=e+"px",n}prepareElementsForAnimation(t,e,i){if(this.style.overflow="hidden",t)this.style.maxHeight=(i?0:this.getClearClientHeight())+"px",this.setContainerElementVisibility(!0);else{const t=this.offsetHeight+e;t>=0&&this.setOffsetHeight(t,null)}}getClearClientHeight(){return this.offsetHeight}getElementVisibility(t){if(t){const t=n.DomUtils.getCurrentStyle(this);if(t)return"none"!==t.display}return"none"!==this.style.display}setOffsetHeight(e,i){i||(i=n.DomUtils.getCurrentStyle(this));let s=e-n.DomUtils.pxToInt(i.marginTop)-n.DomUtils.pxToInt(i.marginBottom);s-=t(this,i),s>-1&&(this.style.maxHeight=s+"px")}startAnimation(t,i,n){this.isAnimating=!0,t!==i?(this.token=this.events.attachEvent(this,"transitionend",n),e((()=>{this.isAnimating&&(this.toggleAttribute(a,!0),this.style.maxHeight=i+"px")}))):n()}onAnimationComplete(){this.setContainerElementVisibility(this.expanded),this.toggleAttribute(a,!1),i((()=>{this.style.overflow="",this.style.maxHeight=""})),this.notifyActualExpandedChanged(),this.checkChildContent()}checkChildContent(){if(!this.expanded&&0!==this.childElementCount&&null!==this.firstElementChild&&this.firstElementChild.hasAttribute(h)){const t=this.querySelectorAll(" ul[data-items-container]");if(!t)return;for(let e=0;e<t.length;e+=1)t[e].style.overflowY="hidden"}}}customElements.define("dxbl-expandable-container",r);const d={loadModule:function(){}};export{r as ExpandableContainer,d as default};
