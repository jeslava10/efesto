import{_ as t}from"./_tslib-6e8ca86b.js";import{V as s,e,B as i,P as o,b as a,D as r,c as n,a as l}from"./popup-9012b161.js";import{P as h}from"./point-e4ec110e.js";import{S as c,b as d}from"./rect-00eb3fa4.js";import{D as p,a as m}from"./popupportal-fcf1c46a.js";import{L as u}from"./layouthelper-dc0e1370.js";import{T as f}from"./transformhelper-ebad0156.js";import{e as g}from"./property-d3853089.js";import{e as y}from"./custom-element-267f9a21.js";import{s as b,i as w,y as C}from"./lit-element-70cf14f4.js";import{i as S,d as E}from"./events-interseptor-8aee1ab4.js";import"./rafaction-bba7928b.js";import"./positiontracker-1fe0834d.js";import"./constants-58283e53.js";import"./branch-bf06b0d2.js";import"./capturemanager-86a8762a.js";import"./eventhelper-8570b930.js";import"./logicaltreehelper-bc8e12d3.js";import"./data-qa-utils-8be7c726.js";import"./pointer-event-helper-ba4ce1e1.js";import"./dx-ui-element-7f5e2dd2.js";import"./lit-element-base-7a85dca5.js";import"./nameof-factory-64d95f5b.js";import"./custom-events-helper-18f7786a.js";var v;const P="dxbl-flyout-arrow";var A;!function(t){t.top="top",t.bottom="bottom",t.end="end",t.start="start"}(A||(A={}));let T=v=class extends b{constructor(){super(...arguments),this.slotChangedHandler=this.handleSlotChanged.bind(this),this.arrow=null,this._alignment=A.bottom,this.position=s.zero,this.serverClass=null,this.clientClass=null,this.cssClass=null}get alignment(){return this._alignment}set alignment(t){const s=this._alignment;this._alignment=t,this.clientClass=this.calcClientCssClass(t),this.requestUpdate("alignment",s)}calcClientCssClass(t){return`dxbl-popover-${t}`}get arrowSize(){return this.arrow?v.calcSizeWithMargins(this.arrow,u.getRelativeElementRect(this.arrow).size):c.Empty}static calcSizeWithMargins(t,s){const e=window.getComputedStyle(t),i=parseFloat(e.marginLeft),o=parseFloat(e.marginRight),a=parseFloat(e.marginTop),r=parseFloat(e.marginBottom);return new c(s.width+i+o,s.height+a+r)}static get styles(){return w`
            :host {
                display: block;
            }
        }`}willUpdate(t){if(t.has("serverClass")||t.has("clientClass")){const t=[];this.clientClass&&this.clientClass.split(" ").forEach((s=>t.push(s))),this.serverClass&&this.serverClass.split(" ").forEach((s=>t.push(s))),this.cssClass=t.join(" ")}}updated(t){if(this.arrow&&t.has("position"))switch(this.alignment){case A.bottom:this.arrow.style.transform=f.translateWithoutFloor(Math.floor(this.position.x),.5);break;case A.top:this.arrow.style.transform=f.translateWithoutFloor(Math.floor(this.position.x),-.5);break;case A.start:this.arrow.style.transform=f.translateWithoutFloor(-.5,Math.floor(this.position.y));break;case A.end:this.arrow.style.transform=f.translateWithoutFloor(.5,Math.floor(this.position.y))}t.has("cssClass")&&(this.className=this.cssClass?this.cssClass:"")}render(){return C`
            <slot @slotchange="${this.slotChangedHandler}"></slot>
        `}handleSlotChanged(t){const s=t.target.assignedNodes();for(const t in s){const e=s[t];if(e instanceof HTMLElement){this.arrow=e;break}}}};t([g({reflect:!1})],T.prototype,"position",void 0),t([g({type:String,attribute:"server-class"})],T.prototype,"serverClass",void 0),t([g({reflect:!1})],T.prototype,"clientClass",void 0),t([g({reflect:!1})],T.prototype,"cssClass",void 0),t([g({reflect:!1})],T.prototype,"alignment",null),T=v=t([y(P)],T);const x="dxbl-flyout-dialog";var R;!function(t){t.Fade="fade",t.None="none"}(R||(R={}));let j=class extends p{constructor(){super(...arguments),this.arrowSlotChangeHandler=this.handleArrowSlotChange.bind(this),this._arrow=null,this._arrowAlignment=A.bottom,this.serverClass=null,this.cssClass=null,this.animationType=R.Fade,this.animationEnabled=!1}get arrow(){return this._arrow}get arrowAlignment(){return this._arrowAlignment}set arrowAlignment(t){this._arrowAlignment=t}calcAnimationTypeCssClass(){return`dxbl-flyout-dialog-${this.animationType} dxbl-flyout-dialog-show`}willUpdate(t){if(t.has("serverClass")||t.has("animationEnabled")||t.has("animationType")){const t=[];if(this.serverClass&&this.serverClass.split(" ").forEach((s=>t.push(s))),this.animationEnabled&&this.animationType!==R.None){const s=t.indexOf(`dxbl-flyout-dialog-${this.animationType}`,0),e=this.calcAnimationTypeCssClass();s>-1?t.splice(s,1,e):t.push(e)}this.cssClass=t.join(" ")}}updated(t){t.has("cssClass")&&(this.className=this.cssClass?this.cssClass:"")}render(){return C`
            <slot></slot>
            <slot name="arrow" @slotchange="${this.arrowSlotChangeHandler}"></slot>
        `}handleArrowSlotChange(t){const s=t.target.assignedNodes();this._arrow=s[0]}};var B,L;t([g({type:String,attribute:"server-class"})],j.prototype,"serverClass",void 0),t([g({reflect:!1})],j.prototype,"cssClass",void 0),t([g({type:String,attribute:"animation-type"})],j.prototype,"animationType",void 0),t([g({type:Boolean,reflect:!1})],j.prototype,"animationEnabled",void 0),j=t([y(x)],j),function(t){t[t.TopStart=1]="TopStart",t[t.Top=2]="Top",t[t.TopEnd=4]="TopEnd",t[t.RightStart=8]="RightStart",t[t.Right=16]="Right",t[t.RightEnd=32]="RightEnd",t[t.BottomStart=64]="BottomStart",t[t.Bottom=128]="Bottom",t[t.BottomEnd=256]="BottomEnd",t[t.LeftStart=512]="LeftStart",t[t.Left=1024]="Left",t[t.LeftEnd=2048]="LeftEnd"}(L||(L={}));class D extends l{constructor(t,s,e,i,o,a){super(s,e,i,o,a),this.flyoutPosition=t}}const M="dxbl-flyout";let z=B=class extends e{get actualDistance(){var t;return null!==(t=this.flyoutDistance)&&void 0!==t?t:2}get actualOffset(){var t;return null!==(t=this.flyoutOffset)&&void 0!==t?t:0}get branchType(){return i.DropDown}constructor(){super(),this.slotChangedHandler=this.handleSlotChange.bind(this),this.dialog=null,this.flyoutDistance=null,this.flyoutOffset=null,this.calcStartAlignment=()=>0,this.calcEndAlignment=(t,s)=>s-t,this.calcAlignment=(t,s)=>s/2-t/2,this.placement=o.Custom,this.fitToRestriction=!0,this.flyoutPosition=0}get child(){return this.root}processCustomPlacement(t,s){return this.calcCustomPlacements(t,s)}calcCustomPlacements(t,s){const e=[];if(!this.dialog||!this.dialog.arrow)return e;const i=this.getBounds(s),o=this.getBounds(t),a=this.dialog.arrow.arrowSize;return this.flyoutPosition&L.Bottom&&e.push(this.calcBottomPlacement(i,a,this.calcAlignment(o.width,i.width),L.Bottom)),this.flyoutPosition&L.BottomStart&&e.push(this.calcBottomPlacement(i,a,this.calcStartAlignment(),L.BottomStart)),this.flyoutPosition&L.BottomEnd&&e.push(this.calcBottomPlacement(i,a,this.calcEndAlignment(o.width,i.width),L.BottomEnd)),this.flyoutPosition&L.Top&&e.push(this.calcTopPlacement(o,a,this.calcAlignment(o.width,i.width),L.Top)),this.flyoutPosition&L.TopStart&&e.push(this.calcTopPlacement(o,a,this.calcStartAlignment(),L.TopStart)),this.flyoutPosition&L.TopEnd&&e.push(this.calcTopPlacement(o,a,this.calcEndAlignment(o.width,i.width),L.TopEnd)),this.flyoutPosition&L.Left&&e.push(this.calcLeftPlacement(o,a,this.calcAlignment(o.height,i.height),L.Left)),this.flyoutPosition&L.LeftStart&&e.push(this.calcLeftPlacement(o,a,this.calcStartAlignment(),L.LeftStart)),this.flyoutPosition&L.LeftEnd&&e.push(this.calcLeftPlacement(o,a,this.calcEndAlignment(o.height,i.height),L.LeftEnd)),this.flyoutPosition&L.Right&&e.push(this.calcRightPlacement(i,a,this.calcAlignment(o.height,i.height),L.Right)),this.flyoutPosition&L.RightStart&&e.push(this.calcRightPlacement(i,a,this.calcStartAlignment(),L.RightStart)),this.flyoutPosition&L.RightEnd&&e.push(this.calcRightPlacement(i,a,this.calcEndAlignment(o.height,i.height),L.RightEnd)),e}calcLeftPlacement(t,s,e,i){const o=new h(-t.width-s.width-this.actualDistance,e+this.actualOffset);return new D(i,o,a.Horizontal,!0,r.Near,n.bottom)}calcTopPlacement(t,s,e,i){const o=new h(e+this.actualOffset,-t.height-s.height-this.actualDistance);return new D(i,o,a.Vertical,!0,r.Near,n.top)}calcRightPlacement(t,s,e,i){const o=new h(t.width+s.width+this.actualDistance,e+this.actualOffset);return new D(i,o,a.Horizontal,!1,r.Far,n.bottom)}calcBottomPlacement(t,s,e,i){const o=new h(e+this.actualOffset,t.height+s.height+this.actualDistance);return new D(i,o,a.Vertical,!1,r.Near,n.bottom)}processBestTranslationResults(t,s,e,i,o,a,r,n,l){if(super.processBestTranslationResults(t,s,e,i,o,a,r,n,l),!this.dialog||!this.dialog.arrow)return;const h=this.calcArrowAlignment(a,r,n);this.dialog.arrowAlignment=h;const c=this.dialog.arrow;c.position=this.getArrowPosition(c,s,e,i,n,null==l?void 0:l.flyoutPosition),c.alignment=h}getArrowPosition(t,e,i,o,r,n){const l=r===a.Vertical,h=l?t.arrowSize.width:t.arrowSize.height,c=d.rectToRange(i,l),p=d.rectToRange(e,l),m=d.rectToRange(o,l);let u=p.start,f=p.end;this.fitToRestriction&&(p.start<=m.start?(u=m.start,f=u+p.size):p.end>=m.end&&(u=m.end-p.size,f=u+p.size));const[g,y]=[Math.max(u,c.start),Math.min(f,c.end)];let b;b=n&(L.RightStart|L.RightEnd|L.LeftStart|L.LeftEnd)?c.start:c.start+c.size/2;const w=this.alignWithinBoundaries(b-h/2,g,y),C=this.calculateArrowOffsetFromEdge(c,h,p);return l?new s(Math.min(Math.max(w-u,C),e.width-C-h),0):new s(0,Math.min(Math.max(w-f,C-e.height),-C-h))}calcArrowAlignment(t,s,e){return e===a.Vertical?s===n.bottom?A.bottom:A.top:t===r.Near?A.start:A.end}alignWithinBoundaries(t,s,e){return s>=e?(s+e)/2:Math.min(Math.max(t,s),e)}calculateArrowOffsetFromEdge(t,s,e){const i=Math.min(t.size-s,t.size/2-s/2);return Math.max(B.DefaultArrowOffsetFromEdge,Math.min(i,.2*e.size))}renderTemplate(){return C`
            <dxbl-branch
                id="branch"
                branch-id="${this.branchId}"
                parent-branch-id="${this.parentBranchId}"
                type="${i.Flyout}">
                <dxbl-flyout-root
                    id="root"
                    style="${this.rootCssStyle}">
                    ${this.renderDefaultSlot()}
                    ${this.renderBridgeSlot()}
                </dxbl-flyout-root>
            </dxbl-branch>
        `}renderDefaultSlot(){return C`<slot @slotchange="${this.slotChangedHandler}"></slot>`}handleSlotChange(t){const s=t.target.assignedNodes();this.dialog=s.find((t=>t instanceof j)),this.dialog&&(this.dialog.animationEnabled=this.animationEnabled),this.reposition()}updated(t){super.updated(t),this.dialog&&t.has("animationEnabled")&&(this.dialog.animationEnabled=this.animationEnabled)}};z.DefaultArrowOffsetFromEdge=8,t([S("#root",!0)],z.prototype,"root",void 0),t([g({type:Number,attribute:"flyout-position"})],z.prototype,"flyoutPosition",void 0),t([g({type:Number,attribute:"flyout-distance"})],z.prototype,"flyoutDistance",void 0),t([g({type:Number,attribute:"flyout-offset"})],z.prototype,"flyoutOffset",void 0),z=B=t([y(M)],z);const F="dxbl-flyout-root";let O=class extends b{constructor(){super(...arguments),this.dropOpposite=!1,this.dropDirection=r.Near,this.dropAlignment=n.bottom}static get styles(){return w`
            :host {
                display: flex;
                flex: 1 1 auto;
                flex-direction: column;
                align-items: stretch;
                justify-items: stretch;
                min-height: 0;
            }
        }`}render(){return C`
            <slot></slot>
            <slot name="arrow"/>
        `}};t([g({type:Object,attribute:"drop-opposite"})],O.prototype,"dropOpposite",void 0),t([g({type:String,attribute:"drop-direction"})],O.prototype,"dropDirection",void 0),t([g({type:String,attribute:"drop-alignment"})],O.prototype,"dropAlignment",void 0),O=t([y(F)],O);function N(t){if(!t)throw new Error("failed");return t}const $={getReference:N,registeredComponents:[M,x,F,m,E,P]};export{$ as default,N as getReference};
