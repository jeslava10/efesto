import{_ as e}from"./_tslib-6e8ca86b.js";import{a as t,b as s,d as i,p as n}from"./utils-4a03fb47.js";import{S as o,v as a,j as r,k as l,T as h,B as d,l as c,m as u,n as p,o as b,p as m,d as g,Z as y,q as f}from"./popup-9012b161.js";import{F as w,c as v}from"./capturemanager-86a8762a.js";import{BranchActivatedEvent as I,BranchIdContext as S,BranchRefreshedEvent as C}from"./branch-bf06b0d2.js";import{T as E,I as x,V as T,D}from"./constants-58283e53.js";import{d as R,b as B}from"./dom-f93f7533.js";import{C as F}from"./css-classes-f3f8ed66.js";import{D as k}from"./layouthelper-dc0e1370.js";import{L as H}from"./logicaltreehelper-bc8e12d3.js";import{P as j}from"./pointer-event-helper-ba4ce1e1.js";import{n as A}from"./nameof-factory-64d95f5b.js";import{C as O}from"./custom-events-helper-18f7786a.js";import{e as z}from"./property-d3853089.js";import{e as L}from"./custom-element-267f9a21.js";import{y as q,s as P}from"./lit-element-70cf14f4.js";import{D as K,a as N}from"./popupportal-fcf1c46a.js";import"./dx-html-element-pointer-events-helper-4b46ddbf.js";import"./eventhelper-8570b930.js";import"./point-e4ec110e.js";import"./rect-00eb3fa4.js";import"./rafaction-bba7928b.js";import"./transformhelper-ebad0156.js";import"./positiontracker-1fe0834d.js";import"./data-qa-utils-8be7c726.js";import"./dx-ui-element-7f5e2dd2.js";import"./lit-element-base-7a85dca5.js";const _=new class{constructor(){this._shadowBranchEvent=new o,this._topShadowId=null,this.shadowSet=new Set}get shadowBranchChanged(){return this._shadowBranchEvent}register(e){this.shadowSet.add(e),this.raiseTopShadowStackChanged()}unregister(e){this.shadowSet.delete(e),this.raiseTopShadowStackChanged()}raiseTopShadowStackChanged(){const e=this.getTopShadowModal();if(this._topShadowId===e)return;this._topShadowId=e;this._shadowBranchEvent.raise({branch:e})}getTopShadowModal(){let e=-1,t="";for(const s of Array.from(this.shadowSet)){const i=a.getIndex(s);i>e&&(e=i,t=s)}return t}},V=F.Prefix+"-prevent-safari-scrolling";const $=new class{constructor(){this.paddingCoerced=!1,this.bodyScrollTop=0,this.bodyScrollPadding="",this.scrollLocked=!1,this.scrollLockHostSet=new Set}register(e){this.scrollLockHostSet.add(e),this.updateScrollLock()}unregister(e){this.scrollLockHostSet.delete(e),this.updateScrollLock()}updateScrollLock(){this.toggleBodyScroll(document.body,this.scrollLockHostSet.size>0)}toggleBodyScroll(e,t){t!==this.scrollLocked&&(this.scrollLocked=t,this.toggleScrollPadding(e,t),R.DomUtils.toggleClassName(e,"dxbl-modal-open",t),B.Browser.Safari&&this.toggleSafariScroll(e,t))}toggleScrollPadding(e,t){if(t){const t=k.getVerticalScrollbarWidth();if(0===t)return;this.paddingCoerced=!0;const s=parseInt(getComputedStyle(document.body).getPropertyValue("padding-right"),10);return this.bodyScrollPadding=document.body.style.paddingRight,void(e.style.paddingRight=`${s+t}px`)}this.paddingCoerced&&(e.style.paddingRight=this.bodyScrollPadding,this.paddingCoerced=!1)}toggleSafariScroll(e,t){t?(this.bodyScrollTop=window.pageYOffset,R.DomUtils.toggleClassName(e,V,t)):(R.DomUtils.toggleClassName(e,V,t),window.scrollTo(0,this.bodyScrollTop))}},M=["a[href]","audio[controls]","button",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details","input","select","textarea","[tabindex]","video[controls]"].join(",");class Z{static getTabbables(e,t){const s=this.findTabbables(e,t),i=[],n=[];return s.forEach(((e,t)=>{const s=Z.getTabIndex(e);0===s?i.push(e):n.push({index:t,tabIndex:s,item:e})})),n.sort(((e,t)=>e.tabIndex===t.tabIndex?e.index-t.index:e.tabIndex-t.tabIndex)).map((e=>e.item)).concat(i)}static findTabbables(e,t){const s=Array.from(e.querySelectorAll(M));return(t&&e.matches(M)||e.webkitMatchesSelector(M))&&s.unshift(e),s.filter(Z.filterTabbable)}static filterTabbable(e){return!e.disabled&&(!Z.isHiddenInput(e)&&(!Z.isHidden(e)&&!(Z.getTabIndex(e)<0)))}static getTabIndex(e){const t=e.getAttribute("tabindex");if(t){const e=parseInt(t,10);if(!isNaN(e))return e}return"true"===e.contentEditable||e.nodeName===E.audio||e.nodeName===E.video||e.nodeName===E.details?0:e.tabIndex}static isHiddenInput(e){return e.tagName===E.input&&e.getAttribute("type")===x.hidden}static isHidden(e){if(window.getComputedStyle(e).visibility===T.hidden)return!0;let t=e;for(;t;){if(window.getComputedStyle(e).display===D.none)return!0;t=t.parentElement}return!1}}class W{constructor(e){this.action=null,this.postponeAction=e}executePostpone(e){this.action=null,this.postponeAction()?e():this.action=e}execute(){this.action&&this.postponeAction()&&this.executeForce()}executeForce(){this.action&&this.action(),this.clear()}clear(){this.action=null}}const Y={subtree:!0,childList:!0,attributeFilter:["disabled","tabindex"]};const X=new class{constructor(){this.element=null,this.tabbables=[],this.lastFocusedElement=null,this.mutationObserver=new MutationObserver(this.handleMutations.bind(this)),this.focusPostponedAction=new W((()=>{var e,t;return null!==(t=(null===(e=this.tabbables)||void 0===e?void 0:e.length)>0)&&void 0!==t&&t})),this.documentFocusInHandler=this.documentFocusIn.bind(this),this.documentKeyDownHandler=this.documentKeyDown.bind(this),this.firstInnerElementKeyDownHandler=this.firstInnerElementKeyDown.bind(this),this.lastInnerElementKeyDownHandler=this.lastInnerElementKeyDown.bind(this),this.handleFocusOutHandler=this.handleFocusOut.bind(this),this.firstInnerElement=null,this.lastInnerElement=null}activate(e){if(this.element="string"==typeof e?document.querySelector(e):e,null===this.element)throw"element is null";this.lastFocusedElement=document.activeElement,this.subscribe(this.element),this.tabbables=Z.getTabbables(this.element,!0),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)),this.mutationObserver.observe(this.element,Y)}deactivate(e){this.element&&(this.focusPostponedAction.clear(),this.mutationObserver.disconnect(),this.unsubscribeDocument(),this.unsubscribe(this.element),this.unsubscribeInnerElementsKeyDown(),e&&!H.containsElement(this.element,document.activeElement)&&this.lastFocusedElement&&w.restoreFocus(this.lastFocusedElement),this.element=null,this.lastFocusedElement=null,clearTimeout(this.updateTabbablesTimerID))}forceFocusFirstElement(){const e=this.tabbables[0];e&&(this.lastFocusedElement&&this.element&&H.containsElement(this.element,document.activeElement)||w.restoreFocus(e))}handleMutations(e){clearTimeout(this.updateTabbablesTimerID),this.updateTabbablesTimerID=setTimeout((()=>{this.tabbables=Z.getTabbables(this.element,!0),this.unsubscribeInnerElementsKeyDown(),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.execute()}),50)}subscribe(e){this.element.addEventListener("focusout",this.handleFocusOutHandler,!0)}unsubscribe(e){this.element.removeEventListener("focusout",this.handleFocusOutHandler,!0)}handleFocusOut(e){const t=e.relatedTarget;t?this.element.contains(t)||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)):this.subscribeDocument()}subscribeDocument(){document.addEventListener("focusin",this.documentFocusInHandler),document.addEventListener("keydown",this.documentKeyDownHandler)}unsubscribeDocument(){document.removeEventListener("keydown",this.documentKeyDownHandler),document.removeEventListener("focusin",this.documentFocusInHandler)}documentKeyDown(e){var t;const s=e.target;if(s&&(this.element===s||(null===(t=this.element)||void 0===t?void 0:t.contains(s))))return;const i=this.element;i&&i.processKeyDown(e)}documentFocusIn(e){const t=e.target;if(!t)return;this.unsubscribeDocument();const s=e.relatedTarget;(s||this.element.contains(t))&&(!s||this.element.contains(s))||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this))}firstInnerElementKeyDown(e){var t;this.firstInnerElement===document.activeElement&&"Tab"===e.key&&e.shiftKey&&(e.preventDefault(),null===(t=this.lastInnerElement)||void 0===t||t.focus({preventScroll:!1}))}lastInnerElementKeyDown(e){var t;this.lastInnerElement!==document.activeElement||"Tab"!==e.key||e.shiftKey||(e.preventDefault(),null===(t=this.firstInnerElement)||void 0===t||t.focus({preventScroll:!1}))}unsubscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.removeEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.removeEventListener("keydown",this.lastInnerElementKeyDownHandler)}subscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.addEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.addEventListener("keydown",this.lastInnerElementKeyDownHandler)}updateInnerElements(){this.tabbables&&(this.firstInnerElement=this.tabbables[0],this.lastInnerElement=this.tabbables[this.tabbables.length-1])}},U="dxbl-modal",G=A();class J{constructor(e){this.closeReason=e}}class Q extends CustomEvent{constructor(e){super(Q.eventName,{detail:new J(e),bubbles:!0,composed:!0,cancelable:!0})}}Q.eventName=U+".closingRequested",O.register(Q.eventName,(e=>e.detail));class ee extends CustomEvent{constructor(e){super(ee.eventName,{detail:new J(e),bubbles:!0,composed:!0,cancelable:!0})}}ee.eventName=U+".closingResultRequested",O.register(ee.eventName,(e=>e.detail));let te=class extends r{constructor(){super(...arguments),this._positionChangedEvent=new l,this.shadowSlotChangedHandler=this.handleShadowSlotChange.bind(this),this.topShadowBranchChangedHandler=this.handleTopShadowBranchChanged.bind(this),this.shadow=null,this.closingResultRequestedTcs=new h,this.shownCompletedTcs=new h,this.popupDialog=null,this._zIndex=0,this.modal=null,this.shadingChangedEvent=new o,this._isOpen=!1,this.shading=!1,this.closeOnOutsideClick=!1,this.closeOnEscape=!1,this.autoZIndex=!1,this.zIndex=0,this.shadowVisible=!1,this.topShadowBranchId=null,this.hasServerSideClosing=!1,this.disableFocusTrap=!1}get positionChanged(){return this._positionChangedEvent}get renderedVisible(){return!0}get isOpen(){return this._isOpen}get branchType(){return d.Modal}get preventInteractions(){return!0}render(){return q`
            <dxbl-branch
                id="branch"
                branch-id="${this.branchId}"
                parent-branch-id="${this.parentBranchId}"
                type="${this.branchType}">
                ${this.renderShadow()}
                ${this.renderDefaultSlot()}
            </dxbl-branch>
        `}renderDefaultSlot(){return q`<slot></slot>`}renderShadow(){return q`<slot name="shadow" @slotchange="${this.shadowSlotChangedHandler}"></slot>`}handleShadowSlotChange(e){const t=e.target.assignedNodes();this.shadow=t.find((e=>e instanceof HTMLElement))}get shadingChanged(){return this.shadingChangedEvent}connectedCallback(){super.connectedCallback(),this.subscribeToEvents()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeFromEvents(),this.close()}show(){return this.isOpen||(this._isOpen=!0,this.initializeCapture(),this.initializeBodyScrollLock(),this.addToVisibleBranchTree(),this.raiseAdjustZIndexRequest(!0)),this.shownCompletedTcs.promise}raiseAdjustZIndexRequest(e){this.dispatchEvent(new c(new u(this.branchId,e)))}close(){this.isOpen&&(this._isOpen=!1,this.releaseCapture(),this.releaseBodyScrollLock(),this.removeFromVisibleBranchTree(),this.raiseAdjustZIndexRequest(!1))}willUpdate(e){this.shadowVisible=this.shading&&this.isOpen&&!!this.branchId&&this.branchId===this.topShadowBranchId}updated(e){this.shadow&&e.has(G("shadowVisible"))&&(this.shadow.style.display=this.shadowVisible?D.block:D.none),e.has(G("zIndex"))&&(this.style.zIndex=this.autoZIndex?"":String(this.zIndex),this.raiseZIndexChange())}ensureBranchId(){if(!this.branchId)throw new Error("branchId should not be null")}addToVisibleBranchTree(){this.ensureBranchId(),a.register(this.branchId),_.register(this.branchId),this.raiseBranchRefreshed()}removeFromVisibleBranchTree(){this.ensureBranchId(),a.unregister(this.branchId),_.unregister(this.branchId),this.raiseBranchRefreshed()}initializeBodyScrollLock(){$.register(this.branchId)}releaseBodyScrollLock(){$.unregister(this.branchId)}subscribeToEvents(){_.shadowBranchChanged.subscribe(this.topShadowBranchChangedHandler)}unsubscribeFromEvents(){_.shadowBranchChanged.unsubscribe(this.topShadowBranchChangedHandler)}handleTopShadowBranchChanged(e){this.topShadowBranchId=e.branch}initializeCapture(){v.capture(this)}releaseCapture(){this.processClosingRequested(!0),v.releaseCapture(this)}processClosingRequested(e){this.closingResultRequestedTcs.resolve(e),this.closingResultRequestedTcs=new h}notifyDialogConnected(e){this.popupDialog=e,this.initializeFocusTrap()}notifyRootConnected(){requestAnimationFrame((()=>{setTimeout((()=>{this.shownCompletedTcs.tryResolve()}))}))}notifyDialogDisconnected(){this.popupDialog=null,this.initializeFocusTrap()}notifyRootDisconnected(){this.shownCompletedTcs.tryReject("cancelled"),this.shownCompletedTcs=new h}gotCapture(){super.gotCapture(),this.activate(),this.initializeFocusTrap()}lostCapture(){super.lostCapture(),this.releaseFocusTrap()}initializeFocusTrap(){this.isOpen&&this.popupDialog&&!this.disableFocusTrap&&X.activate(this.popupDialog)}releaseFocusTrap(){X.deactivate(!this.isOpen)}activate(){const e=new I(new S(this.branchId));this.dispatchEvent(e)}notifyCloseCanceled(){this.processClosingRequested(!1)}async processCapturedPointerDownAsync(e,t){t.handled||j.containsInComposedPath(e,this.popupDialog)||(t.nextInteractionHandled=!0,await p.processCapturedPointerDown(this,e,t))}async processCapturedKeyDownAsync(e,t){t.handled||this.closeOnEscape&&"Escape"===e.key&&await this.processEscape(e,t)}async processEscape(e,t){const s=await this.raiseClosingResultRequestedAsync(b.EscapePress);this.closingResultRequestedTcs=new h,s||(t.handled=!0)}async closeAsync(e,t){const s=await this.raiseClosingResultRequestedAsync(t);return this.closingResultRequestedTcs=new h,e.nextInteractionHandled=!0,e.handled=!0,Promise.resolve(!!s)}async closeHierarchyAsync(e,t,s){for(const e of a.iterateBranch(this.branchId)){const i=await m().getPopup(e);await(null==i?void 0:i.closeAsync(t,s))}await this.closeAsync(t,s)}async raiseClosingResultRequestedAsync(e){if(!this.hasServerSideClosing)return this.raiseClosingRequested(e),!0;const t=new h;return this.closingResultRequestedTcs=t,this.raiseClosingResultRequested(e),t.promise}raiseClosingRequested(e){this.dispatchEvent(new Q(e))}raiseClosingResultRequested(e){this.dispatchEvent(new ee(e))}raiseBranchRefreshed(){const e=new C(new S(this.branchId));this.dispatchEvent(e)}raiseZIndexChange(){this.updateComplete.then((e=>{this.dispatchEvent(new g(new y(this.zIndex)))}))}};e([z({type:Boolean,attribute:"x-is-open",reflect:!0,converter:{fromAttribute:(e,t)=>{throw new Error("readonly")}}})],te.prototype,"_isOpen",void 0),e([z({type:Boolean,attribute:"shading"})],te.prototype,"shading",void 0),e([z({type:Boolean,attribute:"close-on-outside-click"})],te.prototype,"closeOnOutsideClick",void 0),e([z({type:Boolean,attribute:"close-on-escape"})],te.prototype,"closeOnEscape",void 0),e([z({type:Boolean,attribute:"auto-z-index"})],te.prototype,"autoZIndex",void 0),e([z({type:Number,attribute:"z-index"})],te.prototype,"zIndex",void 0),e([z({type:String,attribute:"branch-id"})],te.prototype,"branchId",void 0),e([z({type:String,attribute:"parent-branch-id"})],te.prototype,"parentBranchId",void 0),e([z({reflect:!1})],te.prototype,"shadowVisible",void 0),e([z({reflect:!1})],te.prototype,"topShadowBranchId",void 0),e([z({type:Boolean,attribute:"has-serverside-closing"})],te.prototype,"hasServerSideClosing",void 0),e([z({type:Boolean,attribute:"disable-focus-trap"})],te.prototype,"disableFocusTrap",void 0),te=e([L(U)],te);const se="dxbl-modal-dialog";let ie=class extends K{constructor(){super(),this.actualSize=null,this.actualPosition=null,this.initialSize=null,this.initialPosition=null,this.actualMinWidth=null,this.actualMaxWidth=null,this.actualMinHeight=null,this.actualMaxHeight=null,this.sizeDirty=!1,this.cssTextToApply="",this.popup=null,this.positionY=null,this.positionX=null,this.allowResize=!1,this.width=null,this.height=null,this.minWidth=null,this.minHeight=null,this.maxWidth=null,this.maxHeight=null,this.dialogCssStyle="",t(this)}connectedCallback(){super.connectedCallback(),s(this),this.popup=this.closest(U),this.popup.notifyDialogConnected(this)}disconnectedCallback(){var e;super.disconnectedCallback(),i(this),null===(e=this.popup)||void 0===e||e.notifyDialogDisconnected(),this.popup=null}updated(e){const t=[],s=[];this.dialogCssStyle&&s.push(this.dialogCssStyle),null!==this.positionX&&(t.push(`translateX(${this.positionX}px)`),s.push("margin-left: 0;"),s.push("margin-right: 0;"),s.push("left: 0;")),null!==this.positionY&&(t.push(`translateY(${this.positionY}px)`),s.push("margin-top: 0;"),s.push("margin-bottom: 0;"),s.push("top: 0;")),this.width&&s.push(`width: ${this.width}`),this.height&&s.push(`height: ${this.height}`),t.length>0&&(s.push("position: absolute"),s.push(`transform: ${t.join(" ")}`)),this.cssTextToApply=s.join("; ")}mutate(){this.style.cssText=this.cssTextToApply}render(){return this.allowResize?q`<dxbl-popup-resizable-container><slot></slot></dxbl-popup-resizable-container>`:q`<slot></slot>`}};e([z({type:Number,attribute:"position-y",reflect:!1})],ie.prototype,"positionY",void 0),e([z({type:Number,attribute:"position-x",reflect:!1})],ie.prototype,"positionX",void 0),e([z({type:Boolean,attribute:"allow-resize",reflect:!1})],ie.prototype,"allowResize",void 0),e([z({type:String,attribute:"width",reflect:!1})],ie.prototype,"width",void 0),e([z({type:String,attribute:"height",reflect:!1})],ie.prototype,"height",void 0),e([z({type:String,attribute:"min-width",reflect:!1})],ie.prototype,"minWidth",void 0),e([z({type:String,attribute:"min-height",reflect:!1})],ie.prototype,"minHeight",void 0),e([z({type:String,attribute:"max-width",reflect:!1})],ie.prototype,"maxWidth",void 0),e([z({type:String,attribute:"max-height",reflect:!1})],ie.prototype,"maxHeight",void 0),e([z({type:String,attribute:"dialog-css-style",reflect:!1})],ie.prototype,"dialogCssStyle",void 0),ie=e([L(se)],ie);const ne="dxbl-modal-root";let oe=class extends P{constructor(){super(...arguments),this.slotChangedHandler=this.handleSlotChange.bind(this)}render(){return q`
            <slot @slotchange=${this.slotChangedHandler}></slot>
        `}handleSlotChange(e){const t=e.target.assignedNodes().find((e=>e instanceof ie)),s=this.closest(U);s&&(t?(s.notifyDialogConnected(t),s.notifyRootConnected()):(s.notifyDialogDisconnected(),s.notifyRootDisconnected()))}};oe=e([L(ne)],oe);const ae=[n,se,U,ne,f,N];function re(e){if(!e)throw new Error("failed");return e}const le={getReference:re,registeredComponents:ae};export{le as default,re as getReference,ae as registeredComponents};
